<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="v1.0, 2022">
<title>Rai Multicast Services Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>Rai Multicast Services Guide</h1>
<div class="details">
<span id="author" class="author">v1.0, 2022</span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_description">Description</a></li>
<li><a href="#_architecture">Architecture</a></li>
<li><a href="#_why_use_it">Why use it?</a></li>
<li><a href="#_building">Building</a></li>
<li><a href="#_running_the_ms_server">Running the MS server</a></li>
</ul>
</li>
<li><a href="#config">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_key_configuration">Key Configuration</a></li>
<li><a href="#_single_file_configuration">Single File Configuration</a></li>
<li><a href="#parameters">Parameters</a></li>
</ul>
</li>
<li><a href="#authentication">Authentication</a>
<ul class="sectlevel2">
<li><a href="#_key_exchange">Key Exchange</a></li>
<li><a href="#_system_compromise">System Compromise</a></li>
<li><a href="#_message_authentication">Message Authentication</a></li>
</ul>
</li>
<li><a href="#_subjects">Subjects</a>
<ul class="sectlevel2">
<li><a href="#_wildcarding_subscriptions">Wildcarding Subscriptions</a></li>
<li><a href="#_the_inbox_subject">The _INBOX subject</a></li>
<li><a href="#_rv_subject_rules">RV subject rules</a></li>
<li><a href="#_nats_subject_rules">NATS subject rules</a></li>
<li><a href="#_redis_subject_rules">Redis subject rules</a></li>
</ul>
</li>
<li><a href="#network">Networking</a>
<ul class="sectlevel2">
<li><a href="#_description_of_transports">Description of Transports</a></li>
<li><a href="#service_and_networks">Services and Networks</a></li>
<li><a href="#_cost">Cost</a></li>
<li><a href="#_tcp_encryption">TCP Encryption</a></li>
<li><a href="#_open_pgm">Open PGM</a></li>
<li><a href="#_tcp_mesh">TCP Mesh</a></li>
<li><a href="#_tcp_point_to_point">TCP Point-to-point</a></li>
<li><a href="#Tib_RV">Tib RV</a></li>
<li><a href="#_nats">NATS</a></li>
<li><a href="#_redis">Redis</a></li>
<li><a href="#telnet">Telnet</a></li>
<li><a href="#web">Web</a></li>
</ul>
</li>
<li><a href="#linkstate">Link State</a>
<ul class="sectlevel2">
<li><a href="#_the_forwarding_set">The Forwarding Set</a></li>
</ul>
</li>
<li><a href="#message_loss">Message Loss</a>
<ul class="sectlevel2">
<li><a href="#_multicast_sequence_numbers">Multicast sequence numbers</a></li>
<li><a href="#pub_window">Publish sequence window</a></li>
<li><a href="#_subscription_sequence_window">Subscription sequence window</a></li>
<li><a href="#_configuration_for_sequence_windows">Configuration for sequence windows</a></li>
<li><a href="#_show_loss">Show loss</a></li>
<li><a href="#_notification_of_message_loss">Notification of message loss</a></li>
</ul>
</li>
<li><a href="#_internal_protocol">Internal Protocol</a>
<ul class="sectlevel2">
<li><a href="#_field_values">Field Values</a></li>
<li><a href="#_message_framing">Message Framing</a></li>
<li><a href="#_system_subjects">System Subjects</a></li>
<li><a href="#_heartbeat_subjects">Heartbeat Subjects</a></li>
<li><a href="#_link_state_subjects">Link State Subjects</a></li>
<li><a href="#_subscription_subjects">Subscription Subjects</a></li>
<li><a href="#_inbox_subjects">Inbox Subjects</a></li>
<li><a href="#example_message_flow">Example Message Flow</a></li>
</ul>
</li>
<li><a href="#rvd">rvd Compatibility</a>
<ul class="sectlevel2">
<li><a href="#_rvd_arguments">rvd Arguments</a></li>
<li><a href="#_service_key_configuration">Service Key Configuration</a></li>
<li><a href="#_starting_in_rvd_compatibility_mode">Starting in rvd Compatibility Mode</a></li>
<li><a href="#network_spec">Connecting to Networks</a></li>
<li><a href="#_the_peer_names">The Peer Names</a></li>
</ul>
</li>
<li><a href="#console">Console</a>
<ul class="sectlevel2">
<li><a href="#_description_of_the_console">Description of the Console</a></li>
<li><a href="#_help_screen">Help Screen</a></li>
<li><a href="#ping">Testing Connectivity with Ping</a></li>
<li><a href="#remote">Remote Command Execution</a></li>
<li><a href="#conf_tran">Update and Show the Configuration</a></li>
<li><a href="#conn_listen">Transport Start and Stop</a></li>
<li><a href="#_the_show_commands">The Show Commands</a></li>
<li><a href="#_test_pub_sub">Test Pub Sub</a></li>
<li><a href="#_mute_the_logging">Mute the Logging</a></li>
<li><a href="#_turn_onoff_debug_logging">Turn On/Off Debug Logging</a></li>
<li><a href="#_write_events_to_file">Write Events to File</a></li>
<li><a href="#_stop_the_server">Stop the Server</a></li>
</ul>
</li>
<li><a href="#_monitoring">Monitoring</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description">Description</h3>
<div class="paragraph">
<p>Rai MS is a Link State based protocol for the construction of Pub/Sub messaging
systems which allows for loops and redundancies in the network connections
between peers.  It has 4 different types of network transports:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>OpenPGM based multicast, with an unicast inbox protocol.</p>
</li>
<li>
<p>TCP point to point connections.</p>
</li>
<li>
<p>Mesh TCP all to all connections.</p>
</li>
<li>
<p>Local bridging compatible with RV, NATS, Redis.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first 3 transports may be interconnected with redundancies.  The local
bridging transports strips or adds the meta-data of the message that allows for
routing through the network, so it can&#8217;t be looped.</p>
</div>
<div class="paragraph">
<p>It uses a best effort delivery system.  It serializes messages based on subject
so that streams are delivered in order discarding duplicates, but messages
which are lost in transit because of node or network failures, are not
retransmitted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_architecture">Architecture</h3>
<div class="sect3">
<h4 id="_authentication">Authentication</h4>
<div class="paragraph">
<p>A ECDSA key pair is generated for a service and for each user that is
pre-configured.  A ECDH key is generated for by peer on startup for a key
exchange that establishes a 32 byte session key.  This session key is used to
authenticate messages sent and received.  Each peer in the system has a unique
session key so that a message from any one of them can be authenticated.
This is described further in <a href="#authentication">Authentication</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_console_interface">Console Interface</h4>
<div class="paragraph">
<p>The model that a node implements in the base client is close to that of a
router.  The command line resembles a cisco style interface with the ability to
bring up and down transports at run time, examine the state of them, ping other
nodes, traceroute, get help on commands with the <em>?</em> key, use command line
completion, telnet into the node.  More in <a href="#console">Console</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_networking">Networking</h4>
<div class="paragraph">
<p>A node consists of a router with several transports.  The term "transport" is
modeled as a switch, where other nodes on the transport are attached to switch
and one port of the switch is attached to the router.  All of the nodes plugged
into the switch can communicate without going through the router.  The
facilitates a multicast style transport, where a single multicast send reaches
multiple nodes within the switch.  It also allows an listener to accept
multiple local connections which use a protocol like RV, NATS, or Redis and do
communication without regard to the other nodes attached to other switches or
transports through the router.</p>
</div>
<div class="paragraph">
<p>The subscription mechanism has three layers:  the router, the switch, and the
connection.  The router uses bloom filters to route subjects, the switch uses
32 bit mac addresses based on the subject/wildcard hash, and the connection
uses a btree of subjects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  router &lt;-&gt; bloom filter 1 &lt;-&gt; switch 1 &lt;-&gt; mac 1 &lt;-&gt; connection 1 &lt;-&gt; btree entry 1
             bloom filter 2     switch 2     mac 2     connection 2     btree entry 2</pre>
</div>
</div>
<div class="paragraph">
<p>More about this in the <a href="#network">Networking</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_link_state_database">Link-State Database</h4>
<div class="paragraph">
<p>The first thing a node does after authentication, is download the peers LSDB
(Link-State DB), which first consists of records for every other peer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  { bridge id, session key, peer name, sub seqno, link seqno, bloom }</pre>
</div>
</div>
<div class="paragraph">
<p>The seqno values allow for delta updates of the LSDB, which can add/remove a
link or add/remove a subscription from the bloom filter.  The bloom filter
contains everything needed to filter the subscriptions that the peer has
interest.  It generally uses about 2 bytes per subscription for a false
positive error rate at about 0.05% (1 in 2000 subjects), so if a peer has a
10,000 subjects or wildcards open, it will be about 20,000 bytes in size.</p>
</div>
<div class="paragraph">
<p>Then for each bridge id, it downloads the links that the peer is connected
to for each transport/switch.  The local bridging that occurs for foreign
protocols like RV, NATS and Redis are directly attached to the peer and are
considered the peers subscriptions.  In other words, the bloom filter for a
peer has all of the subscriptions for every RV, NATS or Redis client
connected to it.</p>
</div>
<div class="paragraph">
<p>The link records are for nodes which are directly attached to the peer via
a transport.  There may be many nodes using the same link attached to the
peer and a node may be reachable via multiple transports.  The unique
feature identifying this link is the bridge id, tport id pair.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  { bridge id, tport name, peer name, tport id, cost }</pre>
</div>
</div>
<div class="paragraph">
<p>A delta update of the LSDB, whether link change or subscription change is
broadcast to all of the nodes.  If an network split occurs and some nodes are
orphaned from the network for a period before rejoining, then synchronization
of the LSDB with a peer occurs when the sub seqno or the link seqno has
advanced.  Any peer is capable of updating any other peer since the LSDB is the
same in every one.  The primary means of watching the seqno changes is with a
transport heartbeat sent on a 10 second (default) interval between directly
connected peers.  In addition, each peer randomly chooses another peer to ping
at a random interval based on the heartbeat interval.</p>
</div>
<div class="paragraph">
<p>The behavior of a transport which becomes too congested is that the heartbeat
misses and the link is dropped and rejoined at the next heartbeat.  The effect
of this is that 10 seconds of traffic is rerouted or lost if there are no other
routes to the peers on the other side.</p>
</div>
<div class="paragraph">
<p>More in the <a href="#linkstate">Link State</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_multicast_routing">Multicast routing</h4>
<div class="paragraph">
<p>Any time a link is added to the LSDB, the routing is recalculated using a
Dijkstra path finding algorithm.  The shortest path is chosen, and if multiple
equal paths exist, then the link with the lowest weight is chosen.  Load
balancing can occur when there are two or more equal paths to a peer based on
the subject mac of the destination.  The LSDB is considered "consistent" when
all peers agree that a link exists.  If peer A has an outgoing link to peer B,
then peer B must have a link to peer A.  If this is not the case, then LSDB
synchronization requests to the closest peer along the path are performed until
the network converges to a consistent state.</p>
</div>
<div class="paragraph">
<p>All peers will choose the same route for a subject when the LSDB is
synchronized.  If the LSDB is not synchronized, then messages may be duplicated
to alternative routes or may decide that routing is not necessary for a message
when it is.  For this reason, keeping the LSDB synchronized as fast as possible
is a top priority of a node.</p>
</div>
<div class="paragraph">
<p>A technique called reverse path forwarding is used for multicast messages.  If
a destination unicast to a peer, which is the case for inbox style messaging,
then there is only one path for the message, the shortest path.  With
multicast, there are multiple paths that a message may take, each is the
shortest path to a subscriber.  Reverse path forwarding uses the source of the
message to route it.  The algorithm increments the distance from the source to
compute a set of nodes that are possible for a message at each hop, then
chooses the best traversal of the network graph so that the entire network is
covered with a minimal set of transmissions.  Once this is calculated, it can
be reused until a link in the LSDB is updated again.  This set of paths is
augmented with bloom filters from the peers, so that a router will forward a
message only if it passes through the reverse path forwarding algorithm and it
passes through the bloom filters attached to the path.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wildcard_matching">Wildcard Matching</h4>
<div class="paragraph">
<p>A generic PCRE based conversion is used to enable multiple wildcard styles to
coexist between peers.  The bloom filter contains both a prefix and suffix
matching filter, so that A.*.B is matched with both ends of the wildcard.  When
a subject is passed through a bloom filter the prefix of the subject is hashed
with different seeds based on the prefix lengths used.  If a peer is interested
in subject prefix lengths of 3, 5, 10, 20, as well as the subject itself, these
lengths are noted in the bloom filter and the hash set is calculated as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  hs = hash( subject, seed = 0 )
  h3 = hash( subject[1..3], seed = 3 )
  h5 = hash( subject[1..5], seed = 5 )
  h10 = hash( subject[1..10], seed = 10 )
  h20 = hash( subject[1..20], seed = 20 )</pre>
</div>
</div>
<div class="paragraph">
<p>If any of these are hash values present in the bloom filter, then a check for
the suffix matches are done.  The hash set is computed in groups before any
routing based on the entire set of hashes needed is done in order to take
advantage of instruction parallelism, computing several hashes for each
iteration of the subject length.</p>
</div>
</div>
<div class="sect3">
<h4 id="_anycast_and_shardcast">Anycast and Shardcast</h4>
<div class="paragraph">
<p>An anycast route is a single match of many.  A set of peers interested in a
subject can be computed because the LSDB contains filters for all of them.
This set of peers interested can be randomly chosen and unicast routed to the
chosen peer.  If the peer has a false match, or the interest in the subject is
lost, then that peer can choose another from the set and forward it.</p>
</div>
<div class="paragraph">
<p>A shardcast is a set of peers interested in the prefix of a subject, but only a
shard of the subject space.  The bloom filter contains enough info to filter by
both the prefix hash and the subject space that a peer is interested in.  In
this case, the peers have predetermined how many shards there should be and how
the shards are split between them.  If A subscribes to X.* using shard 1/2 and
B subscribes to X.* using shard 2/2, then the subjects X.Y and X.Z is split
between A and B based on the hash of X.Y and the hash of X.Z.  This is a
variation of suffix matching where the hash of the subject is used to
discriminate the route of the message.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_use_it">Why use it?</h3>
<div class="paragraph">
<p>Distributed systems are more often crossing network boundaries.  Traditional
broker based systems or multicast based systems have difficulty expanding
beyond a these boundaries.  To remedy this, network designs may deploy
application specific routers, or they shard the messaging system, or they use
other protocols like mesh or gossip based systems.  All of these solutions have
advantages and drawbacks.</p>
</div>
<div class="paragraph">
<p>The aim of this system is to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Flexible transports and networking.</p>
</li>
<li>
<p>Fast message authentication.</p>
</li>
<li>
<p>Fast network convergence.</p>
</li>
<li>
<p>Distribute messages only when interest is present.</p>
</li>
<li>
<p>Utilize redundant links.</p>
</li>
<li>
<p>Flexible message distribution:  inbox, multicast, anycast, shardcast.</p>
</li>
<li>
<p>Flexible wildcarding mechanism.</p>
</li>
<li>
<p>Ability to recover subscription interest at the endpoints.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_building">Building</h3>
<div class="paragraph">
<p>There are a lot of submodules and dependencies, so at present, building using
the <a href="https://github.com/raitechnology/build">build</a> Makefile is the easiest way
to compile everything.  Clone it, install the dependencies, clone all of the
modules, build everything.  The rpm dependencies will probably need the
<a href="https://docs.fedoraproject.org/en-US/epel/">EPEL repo</a> installed when using an
enterprise RedHat, CentOS, or derivative for the liblzf-devel package (and
maybe others).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  $ git clone https://github.com/raitechnology/build
  $ cd build
  $ make install_rpm_deps
  $ make clone
  $ make</pre>
</div>
</div>
<div class="paragraph">
<p>If this completes, there will be a static binary at <code>raims/OS/bin/ms_server</code>
where OS is something like <code>RH8_x86_64</code>.</p>
</div>
<div class="paragraph">
<p>If you set the env var for debugging, then the <code>RH8_x86_64-g</code> directory will be
populated without optimization and with the -g flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  $ export port_extra=-g
  $ make</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_ms_server">Running the MS server</h3>
<div class="paragraph">
<p>The first task is to create the authentication keys for a service "test".  The
<code>ms_gen_key</code> program creates and updates the configuration.  The user keys are
what stored in the <code>user_X_svc_test.yaml</code> files and contain ECDH key pairs.
The service is a ECDSA key pair and signs each user and stores the signatures
in the <code>svc_test.yaml</code> file.  The <code>startup.yaml</code> contains the startup config.
The <code>config.yaml</code> file includes all of the files in the config directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  $ cd build/raims
  $ ms_gen_key -u A B C -s test
  create dir  config                          -- the configure directory
  create file config/.salt                    -- generate new salt
  create file config/.pass                    -- generated a new password
  create file config/config.yaml              -- base include file
  create file config/param.yaml               -- parameters file
  create file config/svc_test.yaml            -- defines the service and signs u
  create file config/user_A_svc_test.yaml     -- defines the user
  create file config/user_B_svc_test.yaml     -- defines the user
  create file config/user_C_svc_test.yaml     -- defines the user
  OK? y
  done</pre>
</div>
</div>
<div class="paragraph">
<p>This creates the keys for users A, B, and C.  These keys are encrypted with the
<code>.pass</code> and <code>.salt</code> files.</p>
</div>
<div class="paragraph">
<p>More about this in the [key config guide](keys.md).</p>
</div>
<div class="paragraph">
<p>Run the <code>ms_server</code> program and configure it.  The <code>-u</code> option specifies the
user and service.  The <code>-c</code> option starts the command line interface, where the
networks can be defined and connected.  This following defines a mesh endpoint
and saves it to the startup config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  $ ms_server -u B.test -c
  05:54:26.267  session A.test[RthXjJscfuvnG2+J1/PJ1w] started, start time 1644818066.265990830
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[249]&gt; configure transport mytran
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[250](mytran)&gt; type mesh
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[251](mytran)&gt; listen *
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[252](mytran)&gt; port 5000
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[253](mytran)&gt; show
  tport: mytran
  type: mesh
  route:
    listen: "*"
    port: 5000
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[254](mytran)&gt; exit
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[255]&gt; listen mytran
  transport "mytran" started listening
  05:55:09.934  listening on [::]:5000
  05:55:09.937  network converges 0.003 secs, 0 uids authenticated, add_tport
  A.test[RthXjJscfuvnG2+J1/PJ1w]@tracy[256]&gt; save
  config saved
  05:55:12.790  update file A/param.yaml            -- parameter config
  05:55:12.790  create file A/startup.yaml          -- startup config
  05:55:12.790  create file A/tport_mytran.yaml     -- transport</pre>
</div>
</div>
<div class="paragraph">
<p>The files are described in the <a href="#configuration">[configuration]</a> section and the
transports are described in the <a href="#network">Networking</a> section.  The
authentication keys need to be distributed to all the nodes, but the networking
config will be somewhat unique to each node.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config">Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_key_configuration">Key Configuration</h3>
<div class="paragraph">
<p>The key configuration files are necessary to join the network.  They
authenticate peers and the message traffic that flows between peers.  It does
not authenticate the local bridging protocols RV, NATS, or Redis.</p>
</div>
<div class="paragraph">
<p>Generating a master config is done with the <code>ms_gen_key</code> program.  The default
location for the config directory is <code>./config</code>, other locations are specified
with the <code>-d</code> option.</p>
</div>
<div class="paragraph">
<p>Initially, the config directory is empty.  Initialize with some users and a
service name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ms_gen_key -u A B C -s test
create dir  config                          -- the configure directory
create file config/.salt                    -- generate new salt
create file config/.pass                    -- generated a new password
create file config/config.yaml              -- base include file
create file config/param.yaml               -- parameters file
create file config/svc_test.yaml            -- defines the service and signs users
create file config/user_A_svc_test.yaml     -- defines the user
create file config/user_B_svc_test.yaml     -- defines the user
create file config/user_C_svc_test.yaml     -- defines the user
OK? y
done</pre>
</div>
</div>
<div class="paragraph">
<p>Exporting the keys for each of the nodes causes the <code>.pass</code> file the change and
the unnecessary private keys to be removed.  The only private key that remains,
is for the peer.  This trimmed configuration allows the peer to run, but not
generate new peers because the private key of the service is not present.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ms_gen_key -x A B C -s test
- Loading service "test"
- Signatures ok
create dir  A                          -- exported configure directory
create file A/.salt                    -- a copy of salt
create file A/.pass                    -- generated a new password
create file A/param.yaml               -- a copy of param
create file A/config.yaml              -- base include file
create file A/svc_test.yaml            -- defines the service and signs users
create file A/user_A_svc_test.yaml     -- defines the user
create file A/user_B_svc_test.yaml     -- defines the user
create file A/user_C_svc_test.yaml     -- defines the user
create dir  B                          -- exported configure directory
create file B/.salt                    -- a copy of salt
create file B/.pass                    -- generated a new password
create file B/param.yaml               -- a copy of param
create file B/config.yaml              -- base include file
create file B/svc_test.yaml            -- defines the service and signs users
create file B/user_A_svc_test.yaml     -- defines the user
create file B/user_B_svc_test.yaml     -- defines the user
create file B/user_C_svc_test.yaml     -- defines the user
create dir  C                          -- exported configure directory
create file C/.salt                    -- a copy of salt
create file C/.pass                    -- generated a new password
create file C/param.yaml               -- a copy of param
create file C/config.yaml              -- base include file
create file C/svc_test.yaml            -- defines the service and signs users
create file C/user_A_svc_test.yaml     -- defines the user
create file C/user_B_svc_test.yaml     -- defines the user
create file C/user_C_svc_test.yaml     -- defines the user
OK? y
done</pre>
</div>
</div>
<div class="paragraph">
<p>Copy the A config to the A node/config, the B config directory to the B
node/config, etc.  The <code>.pass</code> file is unique for each peer so that it can be
removed after running the server, rendering the configured keys unreadable
until the <code>.pass</code> file is restored or the peer&#8217;s config is regenerated from the
master config.</p>
</div>
<div class="paragraph">
<p>The copy of the master config includes a copy of the <code>param.yaml</code>, as that can
contain global configuration, but doesn&#8217;t copy any local configuration such as
startup and network configuration.</p>
</div>
<div class="paragraph">
<p>The master config will also work, so just copying it to the peers will allow
them to run if this type of security is unnecessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_single_file_configuration">Single File Configuration</h3>
<div class="paragraph">
<p>The <code>ms_gen_key</code> option <code>-o</code> will concatenate the configuration into a single
file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ms_gen_key -s test -o test.yaml
create dir  config                   -- the configure directory
create file config/.salt             -- generate new salt
create file config/.pass             -- generated a new password
create file config/config.yaml       -- base include file
create file config/param.yaml        -- parameters file
create file config/svc_test.yaml     -- defines the service and signs users
OK? y
done
- Output config to "test.yaml"</pre>
</div>
</div>
<div class="paragraph">
<p>Running <code>ms_server -d config</code> configuration from a directory and running
<code>ms_server -d test.yaml</code> will load the configuration from a file.  In both
cases, the configuration loaded will be the same.</p>
</div>
<div class="paragraph">
<p>A test network can be set up using only the loopback interface by describing
the network using a format output by the <a href="#show_graph">show_graph</a> command.
The format of this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>node A B C D
tcp_link_ab A B : 200
tcp_link_bc B C : 100
tcp_link_ac A C : 200
tcp_link_bd B D : 200
tcp_link_dc D C : 300</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>node</code> line declares all of the users.  The <code>tcp_</code> lines describe how the
users are connected.  The number following the <em>:</em> is the cost of the
transport.</p>
</div>
<div class="paragraph">
<p>Running the <code>ms_test_adj</code> program with this description will generate a
configuration, saved in a file called "graph.txt" and output to "graph.yaml":</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ms_test_adj -l graph.txt &gt; graph.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-l</code> option causes the links to be resolved by exchanging messages over the
loopback interface.  At the bottom of the "graph.yaml" created, there will be
commands in comments to run this configuration.   Running these will create 4
users in a network describe by the graph.  The following uses those commands
with the first three running in the background and the last with a console
attached to it, but you could run each in a different terminal with consoles
attached in order to test with the <a href="#test_sub">sub</a> and
<a href="#test_trace">trace</a> commands to test how messages would be routed through
the network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ ms_server -d graph.yaml -u A -t link_ab.listen link_ac.listen &amp;
$ ms_server -d graph.yaml -u B -t link_ab.connect link_bc.listen link_bd.listen &amp;
$ ms_server -d graph.yaml -u C -t link_ac.connect link_bc.connect link_dc.listen &amp;
$ ms_server -d graph.yaml -u D -t link_bd.connect link_dc.connect -c</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to "tcp" type links, you could also define "mesh" and "pgm" types,
but the pgm would require non-loopback interface that has multicast, like a
Linux bridge.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>node A B C D
mesh_link_abcd A B C D : 100 1000 100 1000
mesh_link_abcd2 A B C D : 1000 100 1000 100</pre>
</div>
</div>
<div class="paragraph">
<p>The above graph would create two meshes, with different costs for some of the
paths.  This would route messages over both meshes by sharding the subject
space and using one mesh for half of the subject space and the other mesh for
the other half.</p>
</div>
<div class="paragraph">
<p>There is a graphical interface to view the network using the
<a href="https://js.cytoscape.org/">cytoscape</a> package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ ms_server -c
chex.test[0vEvE73U78HkGZUgBK94mQ]@chex[10]&gt; configure transport web type web port 8080 listen 127.0.0.1
Transport (web) updated
chex.test[0vEvE73U78HkGZUgBK94mQ]@chex[11]&gt; listen web
Transport (web) started listening
0209 22:54:25.382  web: web start listening on 127.0.0.1:8080
0209 22:54:25.382  http_url http://127.0.0.1:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Connect to the url <a href="http://127.0.0.1:8080/graph_nodes.html" class="bare">http://127.0.0.1:8080/graph_nodes.html</a> with a web browser
and paste the graph text into the text box after erasing the existing text,
then click "show graph".</p>
</div>
</div>
<div class="sect2">
<h3 id="parameters">Parameters</h3>
<div class="paragraph">
<p>The parameters section of the configuration is used to lookup values that can
alter the behavior of the server.  These fields can be set anywhere in the
config files, but are usually in the "param.yaml" or "startup.yaml" files.
Since the "config.yaml" includes "*.yaml", any yaml file in the config
directory can contain parameters.  Any field value pair which is not in a
service, user, service, transport, or group section is added to the parameters
section.</p>
</div>
<div class="paragraph">
<p>This configuration is a list of parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>parameters:
  pass: .pass
  salt: .salt
heartbeat: 5 secs
reliability: 10 secs
tcp_noencrypt: true
listen:
  - mymesh
  - myweb
connect:
  - mytcp</pre>
</div>
</div>
<div class="paragraph">
<p>The "parameters:" structure is optional and not necessary to define them.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">salt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">filename</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File to find encryption salt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">filename</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File to find encryption password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">salt_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base 64 encoded encryption salt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pass_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base 64 encoded encryption password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup listen transports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup connect transports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pub_window_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of publish window</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub_window_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of subscribe window</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pub_window_time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time of publish window</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub_window_time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time of subscribe window</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">heartbeat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval of heartbeat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reliability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time of publish reliability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log using local time or GMT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pid_file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daemon pid file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map_file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use for key value storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db_num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default db number for key value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipc_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to IPC sockets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default timeout for TCP/mesh connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp_ipv4only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use IPv4 addressing only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp_ipv6only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use IPv6 addressing only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp_noencrypt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default for TCP/mesh encryption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp_write_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for TCP write</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp_write_highwater</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP write buffer size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">idle_busy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Busy wait loop count</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>salt, pass, salt_data, pass_data&#8201;&#8212;&#8201;The salt, pass or salt_data, pass_data
are required for startup.  The keys defined in the configuration are
encrypted with these values.  Any key derived during execution is mixed with
the salt and must be the same in all peers.</p>
</li>
<li>
<p>listen, connect&#8201;&#8212;&#8201;The startup transports.  They are started before any other
events are processed.  If a listen fails, then the program exits.  A connect
failure will not cause an exit, since it retries.</p>
</li>
<li>
<p>pub_window_size, sub_window_size, pub_window_time, sub_window_time&#8201;&#8212;&#8201;These
track the sequence numbers of messages sent and received.  They are described
in <a href="#pub_window">Publish sequence window</a>.</p>
</li>
<li>
<p>heartbeat&#8201;&#8212;&#8201;The interval which heartbeats are published to directly
connected peers.  A link is not active when a heartbeat is missed for
1.5 times this interval.  The link is reactivated when a heartbeat is
received.</p>
</li>
<li>
<p>timestamp&#8201;&#8212;&#8201;When set to GMT, the time stamps are not offset by the local
timezone.</p>
</li>
<li>
<p>pid_file&#8201;&#8212;&#8201;A file that contains the process id when forked in rvd mode.</p>
</li>
<li>
<p>map_file&#8201;&#8212;&#8201;If a Redis transport is used, this is where the data is stored.
If no map is defined, then the data stored will fail and data retrieved will
be zero.  The <code>kv_server</code> command will initialize a map file.</p>
</li>
<li>
<p>db_num&#8201;&#8212;&#8201;The default database number for the Redis transport.</p>
</li>
<li>
<p>ipc_name&#8201;&#8212;&#8201;When set, allows IPC processes to connect through Unix sockets
and subscription maps using the same name.  If the processes are shutdown,
they will restart or stop the subscriptions using the maps.</p>
</li>
<li>
<p>tcp_timeout&#8201;&#8212;&#8201;The default retry timeout for TCP and mesh connections.</p>
</li>
<li>
<p>tcp_ip4only&#8201;&#8212;&#8201;Resolve DNS hostnames to IPv4 addresses only.</p>
</li>
<li>
<p>tcp_ip6only&#8201;&#8212;&#8201;Resolve DNS hostnames to IPv6 addresses only.</p>
</li>
<li>
<p>tcp_noencrypt&#8201;&#8212;&#8201;When true, the default for TCP and mesh connections is to
to not encrypt the traffic.</p>
</li>
<li>
<p>tcp_write_timeout&#8201;&#8212;&#8201;Amount of time to wait for TCP write progress if the
write buffer is full.  After this time, socket is disconnected and messages
lost.  When a TCP write buffer has equal or more than <code>tcp_write_highwater</code>
bytes then backpressure can be applied to the sockets that are forwarding
data, causing them to add latency waiting for the writer to have space
available.</p>
</li>
<li>
<p>tcp_write_highwater&#8201;&#8212;&#8201;Amount of data to buffer for writing before applying
back pressure to forwarding sockets.</p>
</li>
<li>
<p>idle_busy&#8201;&#8212;&#8201;Number of times to loop while no activity is present.  More
looping while idle keeps the process on a CPU for lower latency at the
expense of wasted CPU cycles.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication">Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication has two parts, the initial key exchange that sets up unique
session key for each pear and message authentication that verifies that a peer
sent it.  The key exchange protocol uses a Elliptic Curve Diffie Hellman (ECDH)
exchange that is signed by a Elliptic Curve Digital Signature (ECDSA).  The
message authentication uses a HMAC digest computed by enveloping the message
with a peer&#8217;s session key and computing the hash along with sequencing by
subject to prevent a replay of messages.</p>
</div>
<div class="sect2">
<h3 id="_key_exchange">Key Exchange</h3>
<div class="paragraph">
<p>Two peers authenticate with each other by signing a message with a configured
ECDSA key.  This message includes a generated a ECDH public key.  The ECDH key
is used by each side to compute the secret using the corresponding ECDH private
key.  The secret along with a unique nonce, a time stamp, and a sequence number
to create a temporary key that is used to encrypt a random session key.</p>
</div>
<div class="paragraph">
<p>For peers A and B to complete the key exchange, there are 4 messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HELLO/HB from peer A sent to peer B&#8201;&#8212;&#8201;Includes a seqno, a time, a nonce, and
a ECDH public key.  Since these are unique for each side, call these A_seqno,
A_time, A_nonce, A_ECDH_pub</p>
</li>
<li>
<p>AUTH from peer B sent to peer A&#8201;&#8212;&#8201;Includes B_ECDSA_sig, B_seqno, B_time,
B_nonce, B_ECDH_pub, B_auth_key, A_seqno, and A_time.  The A_seqno and A_time
allow peer A to match the unique A_nonce which corresponds to the HELLO
message sent previously.  The last two HELLO messages are tracked so it must
match one of these.  The B_auth_key contains an AES encrypted session key
which must be decrypted by computing a temporary key using the data from B as
well as the ECDH secret computed from B_ECDH_pub and A_ECDH_pri.  Peer A
trusts peer B if the decrypted session key in B_auth_key authenticates the
message using the HMAC computation and the HMAC computation is also signed
by B_ECDSA_sig.</p>
</li>
<li>
<p>AUTH from peer A sent to peer B&#8201;&#8212;&#8201;The reverse of above, includes
A_ECDSA_sig, A_seqno, A_time, A_nonce, A_ECDH_pub, A_auth_key, B_seqno, and
B_time.  The B_seqno and B_time are used to match the B_nonce included in the
previous AUTH and used by peer A to create the temporary key which encrypts
the A_auth_key session key for A.  B trusts peer A if the decrypted session
key in A_auth_key authenticates the message using the HMAC computation and
the HMAC computation is also signed by A_ECDSA_sig.</p>
</li>
<li>
<p>AUTH_OK from peer B sent to peer A&#8201;&#8212;&#8201;This notifies peer B that
authentication was successful.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If either AUTH fails the HMAC computation, then the authentication fails and
one or both peers are ignored for a 20 seconds (or 2 times the heartbeat
interval).  It is possible that the latency of the key exchange is greater than
2 HELLO/HB messages so the nonce associated with the seqno/time pair is too old
and the authentication must restart.</p>
</div>
<div class="paragraph">
<p>The ECDSA private key used to sign the authentication messages is either the
configured key pair from the service or the configured key pair from the user.
A configuration may not include the service private key in the case that a user
has less privileges that the service, which has admin privileges.  The
service&#8217;s private key is able to sign users which don&#8217;t exist and are added to
the system, but a user&#8217;s private key can only authenticate itself.</p>
</div>
<div class="paragraph">
<p>The ECDH algorithm used is
<a href="https://github.com/floodyberry/curve25519-donna">EC25519</a>.  The ECDSA algorithm
used is <a href="https://github.com/floodyberry/ed25519-donna">ED25519</a>.</p>
</div>
<div class="paragraph">
<p>The following is from the <a href="#example_message_flow">Example Message Flow</a>.  This shows the HELLO/HB
part of the key exchange, where peer A is ruby and peer B is dyna.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_X.HELLO ... ruby -&gt; dyna
   bridge_16 [1027]   : xq6vl+2HcoDxtt+7lC7dGQ
   digest_16 [1029]   : mB1uDQ7fsGmYScIGU0kt6Q
   sub_s2 [1792]      : "_X.HB"
   user_hmac_16 [1028] : TQO1sorP9oD+smMOrnvzuQ
   seqno_2 [273]      : 1
   time_8 [787]       : 1663967268385616894
   uptime_8 [788]     : 17982050574
   start_8 [794]      : 1663967250404676993
   interval_2 [277]   : 10
   cnonce_16 [1034]   : IG45ISINnT0bX2Td6Ovivw
   pubkey_32 [1357]   : +A2dlZCcDo8vS/XsWApNNfJwQH8ApmFIRTOcS+cPuAk
   sub_seqno_2 [274]  : 0
   user_s2 [1836]     : "ruby"
   create_s2 [1838]   : "1663967250.404513467"
   link_state_2 [281] : 0
   converge_8 [839]   : 1663967250404676993
   uid_cnt_2 [292]    : 0
   uid_csum_16 [1036] : xq6vl+2HcoDxtt+7lC7dGQ
   version_s2 [1840]  : "1.12.0-42"
   pk_digest_16 [1091] : SMnBqzoh/w6IFi2c7zoxMw</pre>
</div>
</div>
<div class="paragraph">
<p>The seqno_2, time_8, cnonce_16, pubkey_32 are the A_seqno, A_time, A_nonce, and
A_ECDH_pub.  The user_hmac_16, start_8, and service ECDSA_pub are combined to
create a hello_key which is used to authenticate the HELLO message stored in
pk_digest_16, since the session key that is product of the key exchange is not
yet known by dyna.  The service ECDSA_pub is never sent over the wire so it is
used as a pre-shared key in this instance.  There is another pre-shared key
used by the Key Derivation Function (KDF) to generate keys from secrets,
nonces, seqnos, and time stamps.  The KDF is seeded by a 640 byte salt and
shared along with the service ECDSA_pub key in all of the peers that need to
communicate.</p>
</div>
<div class="paragraph">
<p>The first AUTH message from peer B (dyna) to peer A (ruby):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_I.xq6vl+2HcoDxtt+7lC7dGQ.auth ... dyna -&gt; ruby
   bridge_16 [1027]   : wwEnbQEY2FMuwZGSjpi3jQ
   digest_16 [1029]   : 3UY+SJQYy3wGN0dW3zc4fg
   sub_s2 [1792]      : "_I.xq6vl+2HcoDxtt+7lC7dGQ.auth"
   user_hmac_16 [1028] : PYv43FUBG3N8ok+jn4nBPQ
   seqno_2 [273]      : 1
   time_8 [787]       : 1663967268386849657
   uptime_8 [788]     : 63309580030
   interval_2 [277]   : 10
   sub_seqno_2 [274]  : 0
   link_state_2 [281] : 0
   auth_seqno_2 [285] : 1
   auth_time_8 [798]  : 1663967268385616894
   auth_key_64 [1542] : AdM61M2DqR6hXdVnPnp716n5lQwcBAyx0N1jzGtzIM9OmAF4txsoZRd1YMOySIcxkyydHELJHfgVflEtnLg9Fg
   cnonce_16 [1034]   : TEbM+MfLCp66ds36xh0JAA
   pubkey_32 [1357]   : PyEHl7Y3IxAkK5OQMnJzggmlKlUo8+RiBif0P7h+8kg
   auth_stage_2 [305] : 1
   user_s2 [1836]     : "dyna"
   create_s2 [1838]   : "1663967205.077153809"
   expires_s2 [1839]  : null
   start_8 [794]      : 1663967205077372910
   version_s2 [1840]  : "1.12.0-42"
   pk_sig_64 [1610]   : gR2ovdrI4yfxdc7ZAR+ID00hj2HDYEcEexU/ib4CDAU4t2E/nzC6c1dK0s14RiZIWzHHxRFR6D2uJ/ZaHHwaDw</pre>
</div>
</div>
<div class="paragraph">
<p>The auth_seqno_8, auth_time_8 are the A_seqno, A_time values from ruby used to
find the A_nonce (cnonce_16) in the HELLO message.  These along with seqno_8,
time_8, cnonce_16, and pubkey_32 are used to construct the temporary key
to decrypt the auth_key_64, which is session key used by dyna in the HMAC
computation that authenticates messages and compare the result to digest_16.
The pk_sig_64 is the ECDSA signature of the message signed either by the
service&#8217;s private key or by the user dyna&#8217;s private key.</p>
</div>
<div class="paragraph">
<p>After this succeeds, then ruby trusts messages from dyna that have a HMAC
computation digest_16 included with each message, along with an seqno and
time stamp to prevent replays.</p>
</div>
<div class="paragraph">
<p>The second AUTH message from peer A (ruby) to peer B (dyna):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_I.wwEnbQEY2FMuwZGSjpi3jQ.auth ... ruby -&gt; dyna
   bridge_16 [1027]   : xq6vl+2HcoDxtt+7lC7dGQ
   digest_16 [1029]   : h81umkyeNoYJAbomEWE+ng
   sub_s2 [1792]      : "_I.wwEnbQEY2FMuwZGSjpi3jQ.auth"
   user_hmac_16 [1028] : TQO1sorP9oD+smMOrnvzuQ
   seqno_2 [273]      : 1
   time_8 [787]       : 1663967268387280755
   uptime_8 [788]     : 17982688972
   interval_2 [277]   : 10
   sub_seqno_2 [274]  : 0
   link_state_2 [281] : 0
   auth_seqno_2 [285] : 1
   auth_time_8 [798]  : 1663967268386849657
   auth_key_64 [1542] : v4mYze2OruL2L02gODDt7Fd9FHTDPLO0UD/auhab+FJiGgbD473osbwlYKfYBVgwvZMFqbLpVnLiGPHD+MXPtw
   cnonce_16 [1034]   : zUYBUCh9n0L4F0dltxxtyg
   pubkey_32 [1357]   : +A2dlZCcDo8vS/XsWApNNfJwQH8ApmFIRTOcS+cPuAk
   auth_stage_2 [305] : 2
   user_s2 [1836]     : "ruby"
   create_s2 [1838]   : "1663967250.404513467"
   expires_s2 [1839]  : null
   start_8 [794]      : 1663967250404676993
   version_s2 [1840]  : "1.12.0-42"
   pk_sig_64 [1610]   : 6lU9Yz3cvW178goVHwakHsFR55TYid9SHDwjIl/fPrxFVCkCujLxK2HQXNtw3zeVRgmi01pGEqemBUW59YuNDA</pre>
</div>
</div>
<div class="paragraph">
<p>The same exchange from the first AUTH message is used in order for dyna to
trust ruby.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system_compromise">System Compromise</h3>
<div class="paragraph">
<p>If a host is compromised and the KDF pre-shared key and service ECDSA_pub key
are discovered along with a user ECDSA_pri key, then an unauthorized party
could masquerade as that user.  One way to prevent this is to remove the
pre-shared 640 byte salt file after starting a server and a unique password
file used to encrypt the ECDSA keys in the configuration files.  The attacker
would need to extract these from the process space of the server and design a
system that uses this data.</p>
</div>
<div class="paragraph">
<p>The user ECDSA_pri key is needed to authenticate new peers, so it remains in
memory for the duration of the process.  A design that drops the private key
material after this key exchange could prevent this type of attack.</p>
</div>
</div>
<div class="sect2">
<h3 id="_message_authentication">Message Authentication</h3>
<div class="paragraph">
<p>The function of the key exchange protocol is to initialize each peer with a
random 32 byte session key.  The function of this key is to authenticate
messages.  A HMAC calculation of the message is done by enveloping the message
data with the key and hashing it using a AES based hash that results in a 8
byte digest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  AES( IV = 8 bytes key )( [ message ] [ 24 bytes key ] )</pre>
</div>
</div>
<div class="paragraph">
<p>Note that HMAC is traditionally performed as MD5( key.opad + MD5( key.ipad<br>
message ) ) or SHA3( message + key ).  The above AES construction is chosen
purely for speed, since AES instructions are widely available and an order of
magnitude faster than the other hashes.  This may change in the near future
with the addition SHA instructions.</p>
</div>
<div class="paragraph">
<p>The header of every message contains these 5 fields which identify the source
of the message, the HMAC digest of the message, the subject, a seqno and a
time stamp:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   bridge_16 [1027]   : h783olFEb9ve8K07E7PoQg
   digest_16 [1029]   : FKZxGPHiC7e5GXVKh2PWLg
   sub_s2 [1792]      : "_I.xq6vl+2HcoDxtt+7lC7dGQ.ping"
   seqno_2 [273]      : 4
   stamp_8 [838]      : 1663967313973571299</pre>
</div>
</div>
<div class="paragraph">
<p>This header ensures that a message never contains the same bits and is always
unique.  It also allows the receivers to check that a replay has not occurred
by tracking the sequences and time stamps for the subjects that it has seen
previously.  If the subject has never been seen before, then the time stamp is
used to check that the message is at least as old as the last network
convergence time stamp, described in more thoroughly in <a href="#message_loss">Message Loss</a>.  The
bridge_16 identifies the source of the message and the digest_16 is computed
with the source&#8217;s session key.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_subjects">Subjects</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wildcarding_subscriptions">Wildcarding Subscriptions</h3>
<div class="paragraph">
<p>The subject schema used by the external bridged transports may introduce some
incompatibilities when routing from one to another.  The subscriptions and the
patterns are separate operators internally.  A subscription using wildcarding
characters is allowed, but not interpreted differently that any other subject.
A pattern subscription includes a field which causes the pattern to be
evaluated with different syntax rules, Redis GLOB or NATS/RV.  A publish is not
interpreted as a wildcard, even when it contains wildcard syntax.  Any string
of bytes can be subscribed or published, but the wildcarding follows the syntax
of the pattern type and uses a different subscription operator internally, as
Redis does (sub, unsub, psub, punsub).</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_inbox_subject">The _INBOX subject</h3>
<div class="paragraph">
<p>There is a special rule for subjects that begin with the prefix <code>_INBOX.</code>, it
is interpreted as a point to point message.  This subject format finds the
peers which are subscribers, typically just one, and sends the message point to
point for each one.  The subject and message are put into an envelope addressed
for each peer.  The peers that forward this message along the path to the
recipient recognize this as using a different forwarding rule than normal
multicast subjects.  For example, the point to point rules for forwarding will
use a UDP inbox protocol when OpenPGM is deployed.  The point to point rule
will still forward to all subscriptions of an inbox subject, but it is
optimized for the case that there is only one subscription.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rv_subject_rules">RV subject rules</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A subject segment is separated by <code>.</code> and cannot start with a period or end
with a period or have two periods appear within a subject without
characters in between.</p>
</li>
<li>
<p>A wildcard can substitute the segments with a <code>*</code> character or a trailing
<code>&gt;</code>.</p>
</li>
<li>
<p>A publish to a wildcard causes it to match the subjects subscribed.  This
is not supported by Rai MS since the bloom filters are not indexed by
segments.  Instead, Rai MS will route the wildcard publish as a normal
subject.</p>
</li>
<li>
<p>An <code>_INBOX.</code> prefix implies a point to point publish which translates to an
anycast Rai MS publish.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_nats_subject_rules">NATS subject rules</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Same subject segmentation as RV.</p>
</li>
<li>
<p>Same wildcarding as RV.</p>
</li>
<li>
<p>It is not possible to publish to a wildcard.</p>
</li>
<li>
<p>No inbox point to point messaging.</p>
</li>
<li>
<p>A queue group publish translates to a Rai MS anycast publish.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_redis_subject_rules">Redis subject rules</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>There are no limitations for the characters used in a subject.</p>
</li>
<li>
<p>A wildcard is subscribed using a <code>psub</code> operator, so the characters
are interpreted using wildcard rules.  A <code>*</code> character matches zero
or more, a <code>?</code> matches 0 or 1 characters.  A <code>[</code> and <code>]</code> match any
of the characters enclosed.  A <code>\</code> character escapes the wildcard
characters.  It is similar to a shell glob wildcard.</p>
</li>
<li>
<p>A publish to a wildcard is the same as publishing to a subject.</p>
</li>
<li>
<p>No inbox point to point messaging and does not have syntax for
request/reply semantics.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network">Networking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_of_transports">Description of Transports</h3>
<div class="paragraph">
<p>A Rai MS transports function is to join all of the peers connected through a
node together in one virtual overlay network that provides basic pub/sub
multicast.</p>
</div>
<div class="paragraph">
<p>A transport has two primary roles, the routing of messages between peers and
the managing of protocol dependent subscription management and message framing.
The internal transports (PGM, TCP Mesh) all use the internal protocol semantics
for messaging.  The external bridged transports (RV, NATS, Redis) have
protocols with similarities, but they have unique behaviors that make them more
complicated that the internal transports.</p>
</div>
<div class="paragraph">
<p>The design of the internal transports allow them to be used by any of the
external transports, so RV can use a TCP mesh or PGM multicast or some of
combination of them interconnected.  Similar for NATS and Redis, they can also
use PGM multicast as well as a TCP mesh.  The routing of messages between peers
is agnostic to the type of protocol that the endpoint clients are using.  It is
possible to use the Rai MS protocol directly as well.  The <code>ms_server</code> console
contains the ability to publish, subscribe without using an external client.
The Telnet transport uses the console protocol.  The Web transport serves
builtin html pages that interface with the console protocol through websocket
protocol.</p>
</div>
<div class="paragraph">
<p>There are two sides to transport configuration, the listener and the connector.
Only the internal transports support the connecting side (PGM, mesh, TCP), the
client side (RV, NATS, Redis, Telnet, Web) only uses listeners and do not have
a cost.  The device option will auto-discover a connector or listener via
multicast through a device.  This requires that the connector and listener are
on the same broadcast domain or have multicast routing configured.</p>
</div>
<div class="paragraph">
<p>The config file format is a JSON or YAML with a record that can have these
fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: &lt;name&gt;
  type: &lt;pgm | mesh | tcp | rv | nats | redis | telnet | web | name&gt;
  route:
    listen: &lt;address&gt;
    connect: &lt;address&gt;
    device: &lt;address&gt;
    port: &lt;number&gt;
    cost: &lt;number&gt;
    &lt;parm&gt;: &lt;value&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code> identifies the transport so that it can be referenced for starting
and stopping in the console and the command line.  It is also used by auto
discovery to match transports and it is sent to other peers so that it can be
read in log files and diagnostic output.  It has no protocol implications
beyond auto discovery, a misspelling won&#8217;t cause it to stop working.</p>
</div>
</div>
<div class="sect2">
<h3 id="service_and_networks">Services and Networks</h3>
<div class="paragraph">
<p>The endpoint protocols: RV, NATS, Redis; all have a service defined to separate
the data flow from one another.  By using the same service name allows these
endpoints to share the same namespace.  The underlay network that connects the
namespaces can both be configured using the YAML files or the console and also
be specified by the connecting clients.  The clients can specify a network with
PGM multicast or with TCP endpoints and meshes.  All of networks specified by a
client that use TCP will still use multicast to resolve the endpoints by
service name by using the name protocol.</p>
</div>
<div class="paragraph">
<p>Networks use a device name and a protocol or a multicast address.  When a
network is not specified by a client or configuration, then the links between
services have to be configured by the YAML files and/or in the console.</p>
</div>
<div class="paragraph">
<p>Example networks and how they are interpreted.  All of these have a service
name associated with the network, which must match for namespace to
communicate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>eth0;239.1.2.3</code>&#8201;&#8212;&#8201;Connect a PGM protocol to eth0 joining the multicast
address of 239.1.2.3 for communicating with other peers.</p>
</li>
<li>
<p><code>eth0;tcp.listen</code>&#8201;&#8212;&#8201;Connect a name protocol to the eth0 interface and
advertise a TCP listen endpoint.</p>
</li>
<li>
<p><code>eth0;tcp.connect</code>&#8201;&#8212;&#8201;Connect a name protocol to eth0, and advertise a TCP
connection endpoint.  These resolve to a connection when listen endpoints
appear with a clients that use the above.</p>
</li>
<li>
<p><code>eth0;mesh</code>&#8201;&#8212;&#8201;Connect a name protocol to eth0, and advertise a TCP mesh
endpoint.  This creates connections to all other mesh endpoints advertised.</p>
</li>
<li>
<p><code>eth0;any</code>&#8201;&#8212;&#8201;Connect a name protocol to the eth0, and connect to a listen or
a mesh advertised.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The device name eth0 can be substituted with an IPv4 address, like
<code>192.168.1.0;tcp.listen</code>, or a hostname that resolves to an IPv4 address.  If a
network is specified without a name, like <code>;tcp.listen</code>, then the machine&#8217;s
hostname is used to find the device.</p>
</div>
<div class="paragraph">
<p>The configuration for the PGM, name, TCP protocols are generated as needed by
the client if they do not exist.  When a service already is configured, then
it is used instead and the network parameters are ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cost">Cost</h3>
<div class="paragraph">
<p>All of the internal transports have a cost assigned to the links.  The routing
from peer to peer uses this cost to find a path that minimizes the cost.  Equal
cost links are utilized by each peer by encoding a path into the message
header.  This path is enumerated from 0 &#8594; 3, so there is a maximum of 4 equal
cost paths possible between any 2 peers in the network.  The per path cost can
be configured by using different cost metrics for each link.  The default cost
is 1000 so that a configured cost can be less or greater than 1000.  These
configured metrics are replicated throughout the network so that every peer
agrees the cost of every path that exists.  A case where lowering the cost is
useful is when some of the links have higher performance than others as is the
case when all peers exist within a host or within a data center.  A case when
configuring different cost for each of the 4 paths is to load balance multiple
links with equal performance.</p>
</div>
<div class="paragraph">
<p>Example of configuring a lower cost mesh on a bridge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: rv_7500
  type: mesh
  route:
    device: docker0
    cost: 10</pre>
</div>
</div>
<div class="paragraph">
<p>If every container within this host has a RV client that connects with a
network and service of <code>-network eth0;mesh -service 7500</code> then the cost of 10
discovered through the <code>docker0</code> bridge.  The name protocols used will use the
name of the device as their tport name.</p>
</div>
<div class="paragraph">
<p>Example of configuring a load balanced cost for links through a data center:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  transports:
    - tport: a_mesh
      type: mesh
      route:
        listen: *
        connect: [ host, host2, host3, host4 ]
        port: 5000
        cost: [ 100, 1000, 1000, 1000 ]
    - tport: b_mesh
      type: mesh
      route:
        listen: *
        connect: [ host, host2, host3, host4 ]
        port: 5001
        cost: [ 1000, 100, 1000, 1000 ]
    - tport: c_mesh
      type: mesh
      route:
        listen: *
        connect: [ host, host2, host3, host4 ]
        port: 5002
        cost: [ 1000, 1000, 100, 1000 ]
    - tport: d_mesh
      type: mesh
      route:
        listen: *
        connect: [ host, host2, host3, host4 ]
        port: 5003
        cost: [ 1000, 1000, 1000, 100 ]</pre>
</div>
</div>
<div class="paragraph">
<p>This creates 4 equal mesh networks, each of which is preferred for part of the
subject space.  The connect and cost can be enumerated as connect, connect2,
connect3, connect4 and cost, cost2, cost3, cost4 as well as an array.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_encryption">TCP Encryption</h3>
<div class="paragraph">
<p>The TCP type and mesh type links are encrypted using AES 128 bit in counter
mode.  The protocol above the link layer handles the authentication for
trusting the peer and the messages that are received, described in
<a href="#authentication">Authentication</a>.  The encryption is set up by a ECDH exchange.  Each side
generates a ECDH keypair and sends the public key with a checksum and a 128 bit
nonce value.  Each side computes the secret key and uses the KDF to mix the
secret with the nonce value to arrive at a 128 bit key and a 128 bit counter
for sending and receiving.  Thse are used to encrypt and decrypt the other
sides bytes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>alice -&gt; bob [ 8 bytes checksum ] [ 32 bytes pub key ] [ 16 bytes nonce ]
bob -&gt; alice [ 8 bytes checksum ] [ 32 bytes pub key ] [ 16 bytes nonce ]
alice.secret = ECDH( bob public key, alice private key )
bob.secret = ECDH( alice public key, bob private key )
alice.recv key+counter = KDF( secret[32] + bob.nonce[16] ) -&gt; 64 bytes
alice.send key+counter = KDF( secret[32] + alice.once[16] ) -&gt; 64 bytes
bob.recv key+counter = KDF( secret[32] + alice.nonce[16] ) -&gt; 64 bytes
bob.send key+counter = KDF( secret[32] + bob.once[16] ) -&gt; 64 bytes</pre>
</div>
</div>
<div class="paragraph">
<p>The 32 byte secret will be the same on both ends.  The nonce is a random 16
byte value.  The KDF function mixes into the keys a preshared salt value,
generated by ms_key_gen in a "config/.salt" file described in <a href="#config">Configuration</a>.
Without this salt value, the key exchange will compute incorrect keys even
though the secret is computed correctly.</p>
</div>
<div class="paragraph">
<p>The 8 bytes checksum is a CRC of the pub key and the nonce in big endian, so
the first 4 bytes will be zero.  The zero bytes cause an encrypted connection
to an unencrypted endpoint to fail.</p>
</div>
<div class="paragraph">
<p>The 64 byte result of the KDF computation is folded with XOR to arrive at the
16 byte AES key and the 16 byte counter value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_open_pgm">Open PGM</h3>
<div class="paragraph">
<p>PGM is a multicast protocol, which layers reliability on the native UDP
multicast.  The parameters for it declare the amount of memory used for
buffering data and control the timers when retransmitting is necessary.</p>
</div>
<div class="paragraph">
<p>The type of PGM used is UDP encapsulated using the port specified.  The address
specification has a network, a send address, and multiple receive addresses,
formatted as <code>network;recv1,..;send</code>, so this is a valid address:
<code>192.168.1.0;224.4.4.4,225.5.5.5;226.6.6.6</code> where the send address is the last
part and the middle addresses are where packets are received.  If the network
part is unspecified, then the hostname is used to find the interface.  If there
is only one multicast address, then that is used for both sending and
receiving.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_mypgm.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: mypgm
  type: pgm
  route:
    listen: 192.168.1.0;224.4.4.4
    port: 4444
    cost: 100</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">;239.192.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">;239.192.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cost of PGM network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16384</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum UDP packet size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">txw_sqns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send window size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rxw_sqns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive window size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">txw_secs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send window in seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mcast_loop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loop through the host</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The transmit and receive window sizes expand to the reliability time or the
<code>txw_secs</code> parameter.  When the <code>txw_secs</code> is not set, then the reliability
passed on the command line or as a configuration parameter is used.  The
receive window memory is not used until there is packet loss and a
retransmission occurs.  Unrecoverable packet loss occurs when the transmission
window no longer has the sequences that are lost.  The <code>mcast_loop</code>, when set
to 2, allows two peers to share the same network on the same host.  This causes
packets to loop back through the interface and allows multiple PGM networks to
coexist on the same multicast group.</p>
</div>
<div class="paragraph">
<p>In addition to the multicast networking, an inbox protocol is used for point
to point messages.  The network specified in the multicast address is used
as the inbox network, with a random port.</p>
</div>
<div class="paragraph">
<p>The listen and connect addresses act similarly, two peers using different
methods will communicate if the multicast send address matches one of the
receive addresses and the inboxes are connected.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_mesh">TCP Mesh</h3>
<div class="paragraph">
<p>A TCP mesh is a group of peers which automatically maintain connections with
every other peer.  When a new peer joins the mesh, it opens a connection with
all the other peers which are currently members of the mesh.</p>
</div>
<div class="paragraph">
<p>The timeout parameter causes the connecting peer to retry for this amount of
time.  When the timeout expires, the transport will not try to connect until
told to do so again.</p>
</div>
<div class="paragraph">
<p>Multiple connect addresses are normally specified so that some connection
likely succeeds if that network is running.  Allow peers can specify multiple
connect addresses since they use both listen and connect methods to join a
network.  After one connection succeeds, all the other connections in progress
are stopped and the list of mesh members are downloaded from the peers and
those are connected.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_mymesh.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: mymesh
  type: mesh
  route:
    listen: *
    connect: [ host, host2, host3, host4 ]
    port: 9000
    timeout: 0
    noencrypt: true</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active joiner</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">device</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use peer discovery</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener or connect port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active connect timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cost of mesh links</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noencrypt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable encryption</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the mesh is a stable network, then the timeout set to a larger value or zero
can prevent a network split where some parts of the network are isolated for a
period of time.  When a host is restarted doesn&#8217;t have as much of an effect by
a timeout since it is rejoining an existing network.  If a timeout expires,
then an admin request to rejoin the network is possible through the console.</p>
</div>
<div class="paragraph">
<p>When a <code>device</code> parameter is used, then multicast is used through the name
protocol to discover peers that are joining the same mesh, matching using the
tport name.  After discovering the peer, a connection with TCP is used to join
the mesh.  The port can be random with a device, since the address is
discovered rather than connected.  Both the device and connect can be methods
can be used.</p>
</div>
<div class="paragraph">
<p>The <code>noencrypt</code> parameter set to true disables tcp link encryption.  Both the
listener and connector must match this setting, otherwise they will close the
connection after receiving the first bytes sent.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tcp_point_to_point">TCP Point-to-point</h3>
<div class="paragraph">
<p>A TCP point to point connection to another peer.  This is useful to create
ad-hoc topologies at the network boundaries.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_mytcp.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: mytcp
  type: tcp
  route:
    listen: eth0
    connect: host
    port: 9001
    timeout: 0</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active joiner</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">device</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use peer discovery</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener or connect port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active connect timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cost of the TCP link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">edge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A peer at the edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noencrypt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable encryption</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A TCP protocol is either a listener or a connector, the appropriate config is
used at run time when a connect or listen is used to activate the port.  When
device is used to discover the peers through the multicast name protocol, the
listeners are matched with the connectors.  When more than one listener is
discovered by a connector, then connections are made to each one.</p>
</div>
<div class="paragraph">
<p>Whether a configuration is used to connect or listen is specified by a listen
or connect command or configuration.  If multiple connections are specified by
the connect parameter, then the first connection that is successful will cause
the others to stop trying to connect.</p>
</div>
<div class="paragraph">
<p>The <code>edge</code> parameter set to true causes the passive peer to pool the
connections on a single transport, similar to a multicast transport where the
traffic is primarily through a gateway peer.  The <code>noencrypt</code> parameter set to
true disables tcp link encryption.  Both the listener and connector must match
this setting, otherwise they will close the connection after receiving the
first bytes sent.</p>
</div>
<div class="paragraph">
<p>If the <code>listen</code> or <code>connect</code> parameters specify a port, as in "localhost:8000",
then that port overides the parameter <code>port</code> configured.  A device name is
resolved before the hostname DNS resolver is tried, so "eth0:8000" will resolve
the address configured on the eth0 device.</p>
</div>
</div>
<div class="sect2">
<h3 id="Tib_RV">Tib RV</h3>
<div class="paragraph">
<p>The RV protocol supports both the RV5 and RV6+ styles of clients.  The RV6+
clients use the daemon for the inbox endpoint and don&#8217;t create sessions, the
RV5 clients use a unique session for each connection and allow an inbox reply
in the subscription start.  These differences cause decades old software
incompatibilities and pressure to re-engineer legacy messaging systems.</p>
</div>
<div class="paragraph">
<p>There clients usually specify the network and service they want to connect,
which is different from the other clients.  When a client requests to connect
to a multicast network, the Rai MS <code>ms_server</code> will start a PGM transport for
it, unless an existing transport is already defined named with a <code>rv_</code> prefix
and a service numbered suffix.</p>
</div>
<div class="paragraph">
<p>When the <code>rv_7500</code> transport exists as a TCP mesh, then this network is
remapped to the predefined transport when a RV client uses the service 7500
and the multicast network specified by the client is ignored.  When no
multicast network is specified, then no Rai MS transport is created and
the existing transports are used.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_myrv.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: myrv
  type: rv
  route:
    listen: *
    port: 7500</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use_service_prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a service namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no_permanent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exit if no connections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no_mcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignore multicast networking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no_fakeip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use IPv4 address for session</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Unless the use_service_prefix is false, the traffic is segregated to the
<code>_rv_7500</code> where service is 7500.  If it is true, then all services that also
have use_service_prefix set to true will share the same namespace.  Without
<code>no_fakeip</code> set to true, the session and inbox values are random and not based
on the IPv4 address of the host.  This allows RV networks to work without a
routable IPv4 network across private address spaces that are common with
NATs, VMs, and/or container networks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nats">NATS</h3>
<div class="paragraph">
<p>NATS is a pub/sub system that is similar to RV with respect to subject schema
with some extensions for queue groups and optionally persistent message
streaming.  The protocol support does not include the streaming components,
only the pub/sub and queue groups.  NATS does not have an inbox point-to-point
publish scheme, it relies on the client to create a unique subject for this
functionality.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_mynats.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: mynats
  type: nats
  route:
    listen: *
    port: 4222</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_nats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Join a network</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the network is specified, then starting the NATS service will also join
the network.  A network format is as described in <a href="#service_and_networks">Services and Networks</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redis">Redis</h3>
<div class="paragraph">
<p>Redis has a pub/sub component that has slightly different semantics, without a
reply subject for request/reply.  It also uses the term <code>channel</code> to refer to a
subscription.  A pattern subscription is separated by a psub operator, allowing
subscriptions and publishes to any series of bytes.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_myredis.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: myredis
  type: redis
  route:
    listen: *
    port: 6379</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_redis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Join a network</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The data operators that operate on cached structures like lists and sets, etc.
These commands are available when a shared memory key value segment created and
passed as a command line argument to the server (example: -m sysv:raikv.shm), or
defined as a value in the config files (example: map: "sysv:raikv.shm").</p>
</div>
<div class="paragraph">
<p>If the network is specified, then starting the Redis service will also join
the network.  A network format is as described in <a href="#service_and_networks">Services and Networks</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="telnet">Telnet</h3>
<div class="paragraph">
<p>Telnet is a way to get a console prompt, but it doesn&#8217;t start by default.  It
uses the same transport config as the pub/sub protocols.  It also can be used
by network configuration tools to install a configuration remotely.  A telnet
client signals the service that it has terminal capabilities which enables
command line editing.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_mytelnet.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: mytelnet
  type: telnet
  route:
    listen: *
    port: 22</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener port</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="web">Web</h3>
<div class="paragraph">
<p>Web handles http requests and websocket endpoints and integrates an web
application that can be used to graph activity and show internal tables.  The
web application is compiled into the server, so no external file access is
necessary.</p>
</div>
<div class="paragraph">
<p>Example <code>tport_myweb.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: myweb
  type: web
  route:
    listen: *
    port: 80
    http_dir: "./"
    http_username: myuser
    http_password: mypassword</pre>
</div>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passive listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http_dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serve files from this directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http_username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds username to digest auth</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http_password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets password for username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http_realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets realm for username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">htdigest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load digest file for auth</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If http_dir is not set, then this service does not access the filesystem
for processing http get requests.  It has a set of html pages compiled
into the binary that it uses for viewing the server state.</p>
</div>
<div class="paragraph">
<p>If http_dir is set, then the files located in the directory will override the
internal files.  The html files and websocket requests also have a templating
system which substitute values from the server.  If <code>@(show ports)</code> appears in
a html page, it is replace with a html <code>&lt;table&gt;</code> of ports.  If <code>template "res"
: @{show ports}</code> is sent using a websocket, it expands to a JSON array off
ports and the reply is <code>"res" : [ports...]</code>.</p>
</div>
<div class="paragraph">
<p>Any of the commands from the console interface are now exposed on the http
endpoint.  Requesting "show ports" will respond with a JSON array of transports
with the current totals of messages and bytes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ wget --http-user=myuser --http-password=mypassword -q -O - "http://localhost:80/?show ports"
[{"tport":"rv.0", "type":"rv", "cost":1000, "fd":13, "bs":"", "br":"", "ms":"", "mr":"", "lat":"", "fl":"SLI", "address":"rv://127.0.0.1:7500"},
{"tport":"mesh4.1", "type":"mesh", "cost":1000, "fd":16, "bs":"", "br":"", "ms":"", "mr":"", "lat":"", "fl":"SLX", "address":"mesh://10.4.4.18:19500"},
{"tport":"primary.2", "type":"tcp", "cost":1000, "fd":18, "bs":29500, "br":47324, "ms":229, "mr":355, "lat":"26.5ms", "fl":"C", "address":"robotron.1@tcp://209.237.252.104:18500"},
{"tport":"secondary.3", "type":"tcp", "cost":1000, "fd":20, "bs":23276, "br":39134, "ms":181, "mr":311, "lat":"29.4ms", "fl":"C", "address":"edo.2@tcp://209.237.252.98:18500"}]</pre>
</div>
</div>
<div class="paragraph">
<p>The websocket endpoint can also be used to subscribe subjects.  When a message
is published to the websocket, the format used is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"subject" : { "field" : "value" }</pre>
</div>
</div>
<div class="paragraph">
<p>This requires that the messages published  can be converted to JSON or is
already in JSON format.</p>
</div>
<div class="paragraph">
<p>The http_username / http_password or htdigest will cause http digest
authentication to be used and require them for access.  The above wget is used
with the example configuration.</p>
</div>
<div class="paragraph">
<p>A htdigest file contains a list of users and can be created by the htdigest
program distributed with the Apache packages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ htdigest -c .htdigest realm@raims myuser
Adding password for myuser in realm realm@raims.
New password: mypassword
Re-type new password: mypassword

$ cat .htdigest
myuser:realm@raims:56f52efe43dcf419e991ea6452ae6f06</pre>
</div>
</div>
<div class="paragraph">
<p>Then <code>tport_myweb.yaml</code> is configured like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  tport: myweb
  type: web
  route:
    listen: *
    port: 80
    htdigest: ./.htdigest</pre>
</div>
</div>
<div class="paragraph">
<p>Only one realm can be used by the service.  If http_realm is configured then
that realm is used, otherwise the first realm in the htdigest file is used.  If
no realm is specified but a user and password are specified, then "realm@raims"
is used.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="linkstate">Link State</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_forwarding_set">The Forwarding Set</h3>
<div class="paragraph">
<p>Each node in a network must construct a forwarding set for any message sent by
any peer.  A forwarding set instructs the node where to send a message so that
all subscribers of it will see the message exactly one time, when the network
is converged and stable.</p>
</div>
<div class="paragraph">
<p>A "converged network" is one where all peers agree that a link exists.  If
peer A has in it&#8217;s database a link to peer B, then peer B must also have a
link to peer A.  If a link is missing, then the network tries to resolve the
difference by asking the peers with the discrepancy which is correct.</p>
</div>
<div class="paragraph">
<p>Every peer has a bloom filter that contains all of the subscriptions currently
active.  The links database tells each peer how the network can be traversed
for full coverage and the bloom filter prunes the coverage by dropping the
message when there are no subscriptions active that match the subject on the
other side of the link.</p>
</div>
<div class="paragraph">
<p>A simple redundant network is a circle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dyna  --  ruby

  |        |

bond  --  chex</pre>
</div>
</div>
<div class="paragraph">
<p>If the cost of each of the links is set to the default 1000, then the
forwarding set for dyna is the link to ruby and bond.  When ruby and bond
receive a message from dyna, only one of them will forward the message to chex.
The path cost from dyna &#8594; ruby &#8594; chex is equal to the path cost from dyna &#8594;
bond &#8594; chex.  The forwarding algorithm tracks the equal cost paths and ranks
them in order of peer age.  In the case that ruby is older than bond, then the
ranking of these routes would by 1. dyna &#8594; ruby &#8594; chex and 2. dyna &#8594; bond &#8594;
chex.  The top 4 ranked routes are saved as the forwarding sets, and selected
by the hash of the message subject.  In this case, half of the subjects
subscribed by chex and published from dyna would take the first path and the
other half would take the second path.</p>
</div>
<div class="paragraph">
<p>The method of ranking the paths by peer age is used because the stability
of the network is less affected when more transient peers are added and
subtracted from the link state database.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="message_loss">Message Loss</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Under normal conditions, the sequence of the message is one greater than the
last sequence received.  The sequence numbers are 64 bits so they will never be
zero.  These conditions are possible when a sequence is not in incrementing
order from the last message received, which is what normally occurs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Publisher includes a time stamp</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This causes the subscriber to synchronize the sequence numbers.  The publisher
will always include a time stamp when the first message of a subject is
published, or when the last sequence is old enough to be cycled from the
publisher sequence window.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first message received</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a subscription start occurs it will usually not contain a time stamp,
unless it is the first message published.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The message sequence is repeated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sequence is less than or equal the last sequence received.  This indicates
the message was already processed.  The message is dropped.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The message sequence skips ahead</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some sequences are missing, indicating messages were lost.  Notification of
message loss is propagated to the subscriptions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The message subject is not subscribed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subscription may have dropped and the publisher has not yet seen the
unsubscribe.</p>
</div>
<div class="sect2">
<h3 id="_multicast_sequence_numbers">Multicast sequence numbers</h3>
<div class="paragraph">
<p>The sequence numbers include a time frame when the publisher starts the
message stream.  This is the computation that creates a new sequence stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nanosecond time stamp = 1659131646 * 1000000000 = 0x17066b710b706c00

 1               8               16              24
|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-
|0 0 0 1 0 1 1 1 0 0 0 0 0 1 1 0 0 1 1 0 1 0 1 1 0 1 1 1 0 0 0 1
|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-
 32              40              48              56              64
 -+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|
 0 0 0 0 1 0 1 1 0 1 1 1 0 0 0 0 0 1 1 0 1 1 0 0 0 0 0 0 0 0 0 0|
 -+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|

message sequence number = ( nano time &gt;&gt; 33 &lt;&lt; 35 ) + 1 = 0x5c19adc000000001

 1               8               16              24
|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-
|0 1 0 1 1 1 0 0 0 0 0 1 1 0 0 1 1 0 1 0 1 1 0 1 1 1 0 0 0 0 0 0
|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-
 32              40              48              56              64
 -+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|
 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1|
 -+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|</pre>
</div>
</div>
<div class="paragraph">
<p>This truncates nanosecond time stamp to approximately 10 second intervals, a
new time frame can only occur after 10 seconds.  The time frame is stored in
the upper 29 bits will be valid until the year 2115.  The sequence resolution
within a time frame is 35 bits or 34 billion sequences.  These are rotated to
new time frames when the sequence number is zero.</p>
</div>
<div class="paragraph">
<p>These are properties of the time frame encoded in the message sequence numbers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A start of a new multicast stream sequence will use the current time, this
is always after the last convergence time stamp.  The current time is also used
as needed when memory limitations prevent caching of the last sequence
published.  When the sequence is cached, the additional messages won&#8217;t change
the time frame but will increment the sequence number.</p>
</li>
<li>
<p>A new subscription start or uncached sequence publish can verify that the
first message received is greater than the network convergence time.  This is
used to validate that the message stream is uninterrupted to the start of the
time frame, since message loss has not occurred since the before network
convergence.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All of the transports are stream oriented, so a loss of unrecoverable network
packets will cause connections to drop and a new convergence state by pruning
the lost routes.  All peers will agree on a time that convergence is reached.
New time frames are created for all messages published so that the time frame
constructed in any one peer greater than the convergence time in all peers.</p>
</div>
<div class="paragraph">
<p>When routes are added to or subtracted from the network, the message routing is
not stable until all peers have finished adjusting their view of the network.
The peer that publishes a message may use a sub-optimal forwarding path to the
recipients until they are notified that better paths are available with link
state exchanges.</p>
</div>
</div>
<div class="sect2">
<h3 id="pub_window">Publish sequence window</h3>
<div class="paragraph">
<p>A map of subject to sequence numbers for published multicast messages is
maintained by each peer.  This map rotates when a configured memory limit is
reached, <code>pub_window_size</code>, and the window time interval is greater than a
configured time, <code>pub_window_time</code>, which must be at least 10 seconds.  When a
subject is rotated out of the window, the sequence number is restarted with a
new time frame.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subscription_sequence_window">Subscription sequence window</h3>
<div class="paragraph">
<p>A map of subject to sequence numbers for the subscriptions that a peer has
is also maintained.  This validates that the messages are processed in order
and allows notification of message loss when the sequences skip and does not
allow a message to be processed twice.  The memory limit for this is
<code>sub_window_size</code> and time limit is <code>sub_window_time</code>.  When a subject is
rotated out of the window, then the publisher did not update for the window
time and the next sequence is treated as if a new subscription was created.</p>
</div>
<div class="paragraph">
<p>Message duplicates are avoided by discarding messages that are older than the
trailing edge of the subscription sequence window.  The clock skew between
systems is estimated.  The console command <code>show skew</code> will display the
calculated clock skew between systems.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>C.test[Jl8gk4f+gVaf60LxKtsaMg]@dyna[560]&gt; show skew
user |   lat  |   hb   | ref |  ping  |   pong  |     time
-----+--------+--------+-----+--------+---------+-------------
 A.1 |  187us |  451us |   0 |  104us | -2.22us | 01:32:56.384
 B.2 |  304us | 1.25ms |   1 |  207us | -18.9us | 01:32:56.384
 D.3 |  174us |  690us |   0 | 77.2us | -3.73us | 01:32:56.384
 G.4 | 25.8ms |  4.5se |   1 |  4.5se |  4.49se | 01:32:51.897</pre>
</div>
</div>
<div class="paragraph">
<p>The pong calculation subtracts the round trip time and is the most accurate,
the others disregard the latency of the network.  The HB are from time
differences of directly attached peers using heartbeats and are shared with
those not directly attached.  The ref is the peer (0 = self, 1 = A.1) that
originated the HB difference.  The time is the estimated clock setting of the
remote peer in the current timezone.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_for_sequence_windows">Configuration for sequence windows</h3>
<div class="paragraph">
<p>The sizes and windows are in the parameters section of the config file and
default to 4 megabyte (about 60,000 subjects for publishers and 20,000 for
subscribers) and 10 seconds.  The size of the windows will have an overhead of
48 bytes for publishers and 128 bytes for subscribers in addition to the
subject size.  The 10 second rotate timer could cause more memory to be used if
lots of new subjects are published or lots of new subjects are subscribed
within 10 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cat config/param.yaml
parameters:
  pub_window_size: 10 mb
  pub_window_time: 60 sec
  sub_window_size: 10 mb
  sub_window_time: 60 sec</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_show_loss">Show loss</h3>
<div class="paragraph">
<p>The <code>show loss</code> console command displays the messaging statistics for the
peers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>A.test[XftVokMK+WK12CNuEaRFuA]@dyna[545]&gt; show loss
user | repeat | rep time | not sub | not time |  msg loss |   loss time  | ibx loss | ibx time
-----+--------+----------+---------+----------+-----------+--------------+----------+---------
 B.1 |      0 |          |       0 |          |         0 |              |        0 |
 D.3 |      0 |          |       0 |          |       766 | 20:42:24.431 |        0 |
 C.4 |      0 |          |       0 |          |         0 |              |        0 |</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>repeat&#8201;&#8212;&#8201;count of multicast messages received more than one time</p>
</li>
<li>
<p>rep time&#8201;&#8212;&#8201;last time of repeated messages</p>
</li>
<li>
<p>not sub&#8201;&#8212;&#8201;count of multicast messages received which were not subscribed</p>
</li>
<li>
<p>not time&#8201;&#8212;&#8201;last time of not subscribed</p>
</li>
<li>
<p>msg loss&#8201;&#8212;&#8201;number of multicast messages which were lost</p>
</li>
<li>
<p>loss time&#8201;&#8212;&#8201;last time of multicast message loss</p>
</li>
<li>
<p>ibx loss&#8201;&#8212;&#8201;number of messages which were lost from the inbox stream</p>
</li>
<li>
<p>ibx time&#8201;&#8212;&#8201;last time of inbox message loss</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An inbox message loss is not unusual since the point to point messages are
often used for link state exchanges and other network convergence functions.
Inbox message loss is usually not as problematic as multicast message loss
since there often timers are retries associated with their usage.</p>
</div>
<div class="paragraph">
<p>Multicast message loss is much more difficult to recover from, since there
are usually many multicast streams and tracking the state of each one is
a problem solved by persistent message queues.  This requires clients
which track the state of the messages they consume and notify the queue when
they are finished with processing them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_notification_of_message_loss">Notification of message loss</h3>
<div class="paragraph">
<p>If a message arrives with a sequence which is not in order, it is forwarded
with state indicating how many messages are missing, if that can be determined.
The protocol handling of this notification is to publish a message indicating
how many messages were lost.</p>
</div>
<div class="sect3">
<h4 id="_rv_protocol">RV protocol</h4>
<div class="paragraph">
<p>The RV protocol publishes a message to the
<code>_RV.ERROR.SYSTEM.DATALOSS.INBOUND.BCAST</code> subject with a count of lost messages.
These are throttled so that on one is published per second after the first one
is published.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   mtype : "A"
     sub : _RV.ERROR.SYSTEM.DATALOSS.INBOUND.BCAST
    data : {
   ADV_CLASS : "ERROR"
  ADV_SOURCE : "SYSTEM"
    ADV_NAME : "DATALOSS.INBOUND.BCAST"
    ADV_DESC : "lost msgs"
        lost : 7
     sub_cnt : 7
        sub1 : "RSF.REC.PAC.NaE"
       lost1 : 1
        sub2 : "RSF.REC.MTC.NaE"
       lost2 : 1
        sub3 : "RSF.REC.MCD.NaE"
       lost3 : 1
        sub4 : "RSF.REC.MCD.N"
       lost4 : 1
        sub5 : "RSF.REC.SPM4.NaE"
       lost5 : 1
        sub6 : "RSF.REC.MER.NaE"
       lost6 : 1
        sub7 : "RSF.REC.MER.N"
       lost7 : 1
        scid : 7500
  }</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internal_protocol">Internal Protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The protocol is asynchronous with timers to timeout RPCs and to throttle the
rate which peers back off retries.  As a result of this, the message flow for
a network configuration is variable and can change with different conditions.</p>
</div>
<div class="paragraph">
<p>The function of each message is encoded in the subjects with the arguments
passed as field values with some common flags and options encoded in the
message header.</p>
</div>
<div class="paragraph">
<p>Each message is authenticated a session key using a message HMAC.  The initial
key exchange is signed by either the service private key or a configured user
private key.  The heartbeat messages are also authenticated with a hello key
message HMAC derived from the service public key and the start time.  These are
messages that set up the initial key exchange before a session key is
established, but can be weakly authenticated since service public key is
encrypted at rest in the configuration and not shared over the network.</p>
</div>
<div class="paragraph">
<p>Any message that fails authentication is ignored.</p>
</div>
<div class="sect2">
<h3 id="_field_values">Field Values</h3>
<div class="paragraph">
<p>Each field in a message is encoded with a type and length.  This allows new
fields to be added without disrupting the message parsing.  The first 16 bits
encodes the type, length and field id.  The rest of the field encodes the
value.  All integers are encoded in big endian.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fid = BRIDGE(3), type = OPAQUE_16(4) ( opaque 16 bytes )            144
|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+.. +
|1 1 x x 0 1 0 0 0 0 0 0 0 0 1 1|                                     |
 ^ ^     ^.....^ ^.............^ ^....................................
 | |         |        |                        |
 | primitive type(4)  fid(3)               128 bit bridge
 fixed</pre>
</div>
</div>
<div class="paragraph">
<p>The types defined are bool (size:1), unsigned int (size:2,4,8), opaque
(size:16,32,64), string (max size:64k), long opaque (max size:4G).</p>
</div>
<div class="paragraph">
<p>The first two bits, fixed and primitive, indicate whether the type has a fixed
length, and whether the value is a field (primitive) or a message (not
primitive).  A message is another group of fields and is always encoded as a
long opaque with the primitive bit set to 0.  A message payload is always
encoded as a long opaque with the primitive bit set to 1.</p>
</div>
<div class="paragraph">
<p>The types are enumerated as:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opaque 16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opaque 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opaque 64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bit length + up to 64K bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long opaque</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bit length + up to 4G bytes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The field values are aligned on 2 byte boundaries, so the value is padded one
byte when the value size is odd.  There are currently 76 different field ids
(fid) and a maximum of 256 (defined in the header file <code>msg.h</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_message_framing">Message Framing</h3>
<div class="paragraph">
<p>A message frame has 5 fixed length sections and 3 fields that are always
present and use two bytes.</p>
</div>
<div class="paragraph">
<p>These header fields are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject Hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte type + 16 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Digest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte type + 16 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 byte type + 16 bit length + up to 64K</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first 4 bytes encoded as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bytes 0 -&gt; 3 are ver(1), type(2), opt(5), message size (24)
 1               8               16              24              32
|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|-+-+-+-+-+-+-+-|
|1|0 0|0 0 0 0 0|0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 0|
 ^ ^.^ ^.......^ ^.............................................^
 |    \    |                         |
ver(1)|   opt(0)                24 bit size(160)
     type(0)</pre>
</div>
</div>
<div class="paragraph">
<p>The Message Type encodes 4 classes of messages:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast message with routeable payload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inbox</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point to point message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Router Alert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System link state or subscription update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heartbeat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neighbor link keep alive</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A message that has routeable data always has the Multicast or Inbox type set.
The Inbox type message is also used for RPC style communication between peers.
The Router Alert type message alters the routing database by modifying the link
state or the subscription state.  A Heartbeat type is a periodic presence
update.  The peers which are directly connected are responsible for detecting
link failures.</p>
</div>
<div class="paragraph">
<p>The Option Flags is a bit mask that encodes options for messages with Multicast
and Inbox types that are routing data payloads to endpoints.
These are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoints ack the reception</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All peers along the route ack the reception</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is an anycast, destination is one endpoint of many</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is using multicast path 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is using multicast path 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is using multicast path 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is using multicast path 3</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The message size does not include the first 8 bytes, so the message frame size
is 8 + the message size field.  If the size is greater than 24 bits, then the
next 32 bits are used to encode the size and the subject hash is calculated
from the subject.</p>
</div>
<div class="paragraph">
<p>The Bridge, Message Digest and Subject are encoded in Type Length Value format.
The Bridge is a 128 bit identity of the sender.  The Message Digest is the
authentication field.  The receiving peer will authenticate that the message is
valid by using the Bridge to look up the 512 bit session key of the sender and
calculate an HMAC using the message data with the session key and compare it
to the value contained in the Message Digest.  In addition, there are sequence
numbers and time stamps present that prevent the replay of each message frame.</p>
</div>
<div class="paragraph">
<p>The 4 multicast path options will select the one of the equal cost paths
calculated from the current link state.  Every peer can calculate these paths
using the same replicated link state database, this results in 4 forwarding
trees to the same destinations if there are enough redundant links.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system_subjects">System Subjects</h3>
<div class="paragraph">
<p>The peers exchange messages to authenticate new peers, synchronize the link
state of the network, subscription updates, and heartbeats to maintain neighbor
links.  These types of messages have unique subject prefixes as well as bits in
the message type header indicating whether it is special.</p>
</div>
<div class="paragraph">
<p>There are 7 classes subject prefixes used:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inbox point to point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_M.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic multicast message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heartbeat link presence message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link state broadcast message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_S.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal subscription multicast message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_P.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pattern subscription multicast message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_N.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer statistics multicast message</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A broadcast style forwarding used by _Z, subjects is different from multicast
forwarding.  It will flood the authenticated peers in the network, adjusting
each peer&#8217;s routing database as it is received.  It uses this type of
forwarding because this kind of update may cause the multicast forwarding to be
temporarily incomplete until the network converges again.</p>
</div>
<div class="paragraph">
<p>The forwarding path for the Inbox, Heartbeat and broadcast subjects does not
follow the multicast forwarding path, so they can&#8217;t be subscribed.</p>
</div>
<div class="paragraph">
<p>There is a separate sequence number domain defined for these because of the
idempotent nature of maintaining the replicated state of the network.  If a
peer misses messages for a delta changes in the subscriptions or links
database, the state is reinitialized by replicating it from an up to date peer.</p>
</div>
<div class="paragraph">
<p>The multicast subjects follow normal forwarding rules.  The _M prefix is used
for a multicast ping and a multicast link state sync.</p>
</div>
<div class="paragraph">
<p>The _N prefix has unique subjects for link and peer statistics like messages
sent or received, bytes sent or received, as well as adjacency notifications.
These are used to monitor an individual node or a group of them with pattern
subscriptions.  These stats are not sent unless there are subscriptions open.</p>
</div>
</div>
<div class="sect2">
<h3 id="_heartbeat_subjects">Heartbeat Subjects</h3>
<div class="paragraph">
<p>These are sent on a link between directly connected peers.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subject</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.HELLO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First message sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.HB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Periodic message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.BYE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last message sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link discovery message</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>_X.HELLO and _X.HB messages have two functions, the first is to initiate the
authentication key exchange.  The second is to keep a peer up to date with
the last sequence numbers used by the subscription and link state.  When
heartbeats are not received within 1.5 intervals.  The interval default is 10
seconds, this causes a link to be deactivated at :15 when HB expected at :10.
When all of the direct links to a peer are inactive, then the peer is
unauthenticated and marked as a zombie.  The heartbeat timeout does not
depend on a transport timeout, like a TCP reset.  The result of this behavior
is that overloaded or congested links that delay messages for longer than the
1.5 times the heartbeat interval will may incur message loss.  This puts an
upper bound on the link latency and alleviates back pressure to the publisher.</p>
</li>
<li>
<p>_X.BYE causes the peer to be unauthenticated and dropped from the peer db.</p>
</li>
<li>
<p>_X.NAME messages are multicast to a device for presence detection.  Links
between peers are only established when the type and name of a transport is
matched within a service.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_link_state_subjects">Link State Subjects</h3>
<div class="paragraph">
<p>These are broadcast flooded to authenticated peers.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subject</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New peer added to peer db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.DEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dropped peer from peer db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.BLM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription bloom filter resized</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adjacency changed, link added or removed</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>_Z.ADD is broadcast when a new peer is added to the peer db, usually as a
result of authentication and also in the case when network splits and peers
were joined again.</p>
</li>
<li>
<p>_Z.DEL is broadcast when a peer sent a _X.BYE or if it is no longer reachable
because all routes to it are down.</p>
</li>
<li>
<p>_Z.BLM is broadcast when a peer resizes the bloom filter associated with the
subscriptions and patterns it has open, this occurs approximately when
crossing powers of two subscription counts (currently at 31, 62, 124, 248,
&#8230;&#8203;).</p>
</li>
<li>
<p>_Z.ADJ notifies when a peer adds are subtracts a link to another peer.  It
increments the link state sequence number so that peers apply this update
only when the link state reflects the current state, otherwise a RPC
synchronization request is used (_I.[bridge].sync_req) to resync.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_subscription_subjects">Subscription Subjects</h3>
<div class="paragraph">
<p>These are multicast to authenticated peers.  They are updates to the bloom
filter that can be missed and resynchronized with _Z.BLM or a resync RPC
request.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subject</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_S.JOIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start a subscription</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_S.LEAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop a subscription</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_P.PSUB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start a pattern subscription</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_P.STOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop a pattern subscription</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>_S.JOIN and _S.LEAV add and subtract subscriptions to a subject.</p>
</li>
<li>
<p>_P.PSUB and _P.STOP add and subtract pattern subscriptions.  These contain a
pattern type as well as the pattern string.  The pattern types currently
supported are either a RV style wildcard or a Redis glob style wildcard.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_inbox_subjects">Inbox Subjects</h3>
<div class="paragraph">
<p>The format of a subject with an _I. prefix also encodes the destination of the
message by appending the 128 bridge id in base64.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_I.duBVZZwXfwBVlYgGNUZQTw.auth</pre>
</div>
</div>
<div class="paragraph">
<p>All of the peers along the path to the destination use this bridge id to
forward the message using the rules for the point to point route of the
destination peer.  This may be a TCP link or it may be a UDP Inbox link in the
case of a multicast PGM transport.  The suffix of the inbox subject indicate
the type of request or reply it is.  If the suffix is an integer then the
endpoint is not a system function, but information requested by the console
session or a web interface that is usually converted to text and displayed.</p>
</div>
<div class="paragraph">
<p>These suffixes are currently recognized:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Suffix</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request authentication, peer verifies with user or service pub key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request and match active subscriptions strings with a pattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request a pong reply, also has seqnos for maintaining state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pong</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reply to a ping, has latency information and update clock skew</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote admin request, run a console command from another peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add_rte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After authenticated with peer, it will add other peers it knows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer sends when it finds an old peer db or subscription state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sync_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response to a sync_req, includes current state if it is out of date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bloom_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer requests bloom state, currently peers use adj_req instead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bloom_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response to a bloom_req, contains the bloom map of the subscriptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adj_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer requests when it finds an old link state or subscription state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adj_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response to adj_rpy, contains an up to date link state and bloom map for peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mesh_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer requests when it detects a missing mesh member</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mesh_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response to mesh_rpy, contains missing link URLs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response to messages which have the Trace option flag in header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response to messages which have the Ack option flag in header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encapsulates a peer _INBOX message, for point to point routing</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Auth does a key exchange between two peers.  After completing successfully,
each peer has a session key for the other.  This allows messages to be
sent by the other to be authenticated using Message Digest field.</p>
</li>
<li>
<p>Subs is a request for the open subscriptions.  It is used by the console and
the web interface for examining the network.  The RPC reply is always a
numeric string to forward to the terminal or web page that requested it.</p>
</li>
<li>
<p>Ping and pong are latency gathering functions for any two peers in the
network, not necessarily directly connected.  The current sequence numbers
for the link state and subscription state are also exchanged for synchronizing
peers which are not directly connected.</p>
</li>
<li>
<p>Rem is a remote console command execution, used in the console and web
interfaces.</p>
</li>
<li>
<p>Add_rte is used after the auth key exchange to replicate the peer db to a new
peer.  This initial peer db only contains the names and bridge ids, so the
new peer must request session keys, link state and subscription state for
peers it does not already know about.</p>
</li>
<li>
<p>Sync_req and sync_rpy are used replicate the session keys.  If a new peer
does not have the session info from a _Z.ADD or a add_rte, it will request it
from the peer that notified of the unknown peer session.  This will often be
the case after authentication occurs and the new peer receives an add_rte
from an older peer that has a db with the current state of the network.  This
is the only other way that the unique session keys for each peer is
distributed besides directly authenticating with a key exchange.  The sync_rpy
also includes the link state and subscription bloom filter of requested peer.</p>
</li>
<li>
<p>Bloom_req and bloom_rpy are RPCs for the subscription bloom filter.  The
adj_req and adj_rpy are used instead for this info.</p>
</li>
<li>
<p>Adj_req and adj_rpy are the main method that peers recover the current link
state and subscription state.  They work in a RPC request/response style.
The request contains the sequence numbers that the source peer has in it&#8217;s
db.  The destination peer compares these numbers with it&#8217;s own db and replies
when a sequence needs updating.  Usually the destination peer is the one that
the source needs synchronized, but a closer peer can be queried as well.
This occurs when a lot of peers need to resynchronize as a result of a
network split and reconnect.</p>
</li>
<li>
<p>Mesh_req and mesh_rpy are RPCs for distributing URLs for peers in the same
mesh network.  When a peer connects to a mesh, it uses the initial connection
to find the addresses of all the other peers in the mesh with this RPC.</p>
</li>
<li>
<p>Trace and ack are sent as a multicast message is forwarded with the Message
Options set in the header.  These can be requested from a console publish
using the "trace" or "ack" commands.</p>
</li>
<li>
<p>Any encapsulates an _INBOX point to point message and forwards it to the
correct peer.  An _INBOX publish does not have a destination other than a
unique subject that another peer has subscribed, for example
"_INBOX.7F000001.2202C25FE975070A48320.&gt;".  The peer that encapsulates this
message finds the possible destinations by testing the bloom filters it has
and then forwards to the matching peers.  The usual case is that there is
only one matching destination.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="example_message_flow">Example Message Flow</h3>
<div class="paragraph">
<p>Two peers key exchange, ruby connecting to dyna:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Packet</th>
<th class="tableblock halign-left valign-top">Subject</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.HELLO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial hello message after connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.xq6vl+2HcoDxtt+7lC7dGQ.auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna authenticates with ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.wwEnbQEY2FMuwZGSjpi3jQ.auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby authenticates with dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby adds dyna to peer db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby adds link to dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna adds link to ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.xq6vl+2HcoDxtt+7lC7dGQ.auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna confirms authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna adds ruby to peer db</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Ruby connecting dyna, a member of a network of 4 nodes: dyna, zero, one, and
two.  This is the message flow between ruby and dyna, which completes the initial
synchronization of ruby.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Packet</th>
<th class="tableblock halign-left valign-top">Subject</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_X.HELLO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial hello message after connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna authenticates with ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.tXB702RHKF0M69dl7K7vrw.auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby authenticates with dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby adds dyna to peer db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby adds link to dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.tXB702RHKF0M69dl7K7vrw.adj_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby requests adjacency of dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna adds link to ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna confirms authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna adds ruby to peer db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.add_rte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna populates ruby peer db of other peers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.adj_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna replies to adj_req, links to other peers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.tXB702RHKF0M69dl7K7vrw.sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby requests sync of peer zero from dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.tXB702RHKF0M69dl7K7vrw.sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby requests sync of peer one from dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.tXB702RHKF0M69dl7K7vrw.sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby requests sync of peer two from dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.sync_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna replies key, links, bloom for peer zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.sync_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna replies key, links, bloom for peer one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.q6pEpnzNyANEZKKp29532Q.sync_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna replies key, links, bloom for peer two</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is also message flow between dyna and zero, one, two.  This is the flow between dyna and zero.  The
message flow between dyna and one, dyna and two is the same as dyna and zero.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Packet</th>
<th class="tableblock halign-left valign-top">Subject</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna notifies the new link from dyna to ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna notifies the add ruby to peer db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">forward from ruby for new link from ruby to dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.tXB702RHKF0M69dl7K7vrw.sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero requests sync of peer ruby from dyna</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_I.ia988C6TtC6/L3JC6D3GqA.sync_rpy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna replies key, links, bloom for peer ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_Z.ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dyna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero notifies the add of ruby to peer db</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Adding ruby to the network ripples through the directly connected peers, which
discover the new peer from the broadcasting of the _Z.ADD messages and then
synchronize with each other to merge the ruby session key, the link state, and
the subscription bloom state into the network state.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rvd">rvd Compatibility</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_rvd_arguments">rvd Arguments</h3>
<div class="paragraph">
<p>If <code>ms_server</code> is started in <code>rvd</code> compatible mode, it will automatically start
a rv protocol on 7500 and a web service on 7580 unless arguments are present
that modify this.  The protocol that is used between daemons is not compatible
with <code>rvd</code>, but it does allow <code>rv</code> clients to connect and communicate.  In
other words, the client side is compatible, but the network side is not.</p>
</div>
<div class="paragraph">
<p>These arguments are recognized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ms_server -help
   -cfg               : config dir/file (default: exe_path/rv.yaml)
   -reliability       : seconds of reliability (default: 15)
   -user user.svc     : user name (default: hostname)
   -log               : log file
   -log-rotate        : rotate file size limit
   -log-max-rotations : max log file rotations
   -no-permanent      : exit when no clients
   -foreground        : run in foreground
   -listen            : rv listen port
   -no-http           : no http service
   -http              : port for http service (default: listen + 80)
   -no-mcast          : no multicast
   -console           : run with console</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_key_configuration">Service Key Configuration</h3>
<div class="paragraph">
<p>Without any arguments, the config file <code>rv.yaml</code> is loaded from the directory
that <code>ms_server</code> is installed.  This config file can be generated with the
<code>ms_gen_key</code> program.  It should be the same for each instance that is joining
the same network and service, since it contains the service key pair that
authenticates the daemon with other daemons located on the network.</p>
</div>
<div class="paragraph">
<p>If <code>ms_server</code> is installed in <code>/usr/local/bin</code> then this can generate the
default config file for it in <code>rvd</code> mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ms_gen_key -y -s rvd -o /usr/local/bin/rv.yaml
create dir  config                  -- the configure directory
create file config/.salt            -- generate new salt
create file config/.pass            -- generated a new password
create file config/config.yaml      -- base include file
create file config/param.yaml       -- parameters file
create file config/svc_rvd.yaml     -- defines the service and signs users
done
- Output config to "/usr/local/bin/rv.yaml"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/usr/local/bin/rv.yaml</code> file must be installed on every machine that
connects to the network and expects to communicate with the initial machine.
The contents define the service key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cat /usr/local/bin/rv.yaml
services:
  - svc: rvd
    create: 1663653977.579093187
    pri: QQ5FR17BZktlJnxW/Ln3YExIoq12rf725FEysQwjGJRSNmgskzUA70fQCivq...
    pub: IskYDB7cvb1TIiaGZQ7ZAtWAlwhvGa/7rEfyiRKVp2U10sH3Yl6Eo19c0J1V...
parameters:
  salt_data: hDqyoJ9JSXEEBpiueoNPDEqxy3nsEOt7uoDrSvn4DlSvrLZDNQKG3fmK...
  pass_data: M+ALrLzVLaf/2OlRd7FTstX6pzAF66KQR86EhCxlwXY</pre>
</div>
</div>
<div class="paragraph">
<p>The above service key pair is unique for every <code>ms_gen_key</code> execution.  The
private key is used to sign the authentication messages exchanged between
daemons, and the public key is used to verify that the peer is allowed to
exchange messages on the network.  Unauthenticated peers will be ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_starting_in_rvd_compatibility_mode">Starting in rvd Compatibility Mode</h3>
<div class="paragraph">
<p>If the <code>ms_server</code> is linked to <code>rvd</code> and run that way, it will run in
compatibility mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ln -s /usr/local/bin/ms_server /usr/local/bin/rvd
$ /usr/local/bin/rvd
rvd running at [::]:7500
web running at [::]:7580
moving to background daemon</pre>
</div>
</div>
<div class="paragraph">
<p>Unless the -foreground or the -console options are used, it forks itself to
release from the terminal that it is started.  <code>ms_server</code> will also run in
compatibility mode when an argument above is used, for example, <code>ms_server
-listen 7501 -http 7581 -reliability 60</code> will run in compatible mode.</p>
</div>
<div class="paragraph">
<p>If there is already a <code>rvd</code> running on port 7500, it will fail to start and
exit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ rvd
0919 23:13:08.635! rvd.0 listen *:7500 failed
0919 23:13:08.635! web: failed to start web at *.7580</pre>
</div>
</div>
<div class="paragraph">
<p>A HUP signal will cause it to exit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ killall -HUP rvd</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="network_spec">Connecting to Networks</h3>
<div class="paragraph">
<p>The network parameter that the client specifies controls which network that
the <code>ms_server</code> joins.  It can specify a multicast address, TCP connections, or
a TCP mesh.  Only daemons which connect to the same network will communicate.</p>
</div>
<div class="paragraph">
<p>The formats of these are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Network</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eth0;239.192.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PGM multicast address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eth0;mesh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mesh network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eth0;tcp.listen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP listen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eth0;tcp.connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eth0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANY connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(empty)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no network</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A mesh network causes all the daemons to connect with one another by listening
to a random port and multicasting that port to eth0.  When other daemons
receive this message, they will establish TCP connections with each other
daemon.</p>
</div>
<div class="paragraph">
<p>A TCP network causes the listeners to multicast their random ports to eth0.
When daemons that have tcp.connect as a network receive this message, they will
connect to the listener.  Multiple TCP listeners can exist on the same network.
The result of having two "eth0;tcp.listen" specifications and two
"eth0;tcp.connect" would be that both connectors will establish connections to
both of the listeners.</p>
</div>
<div class="paragraph">
<p>The PGM multicast address uses UDP encapsulated multicast on the service port
using OpenPGM and a UDP point to point protocol for inbox messaging.</p>
</div>
<div class="paragraph">
<p>The sockets will be bound to the eth0 interface with random ports, except for
the PGM socket, which uses a wildcard address for joining the multicast and the
service port for sending messages.  Multiple services can join the same
network, so -service 7500 and -service 7600 can coexist using the same network
specification.</p>
</div>
<div class="paragraph">
<p>When two <code>ms_server</code> instances are using the network "eth0;mesh" on service
7500 and service 7600, the ports console command will show these networks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>host1_7500.rv[+u7D0t7Cf5MP2USlooBtyA]@host1[632]&gt; ports
   tport  | type | cost | fd | ... |  fl  |                   address
----------+------+------+----+-----+------+-------------------------------------------
    rvd.0 |   rv |      | 13 |     |  SLI |                             rv://[::]:7500
rv_7500.1 | mesh | 1000 | 19 |     | SLXD |                     mesh://10.88.0.2:37277
rv_7500.2 | mesh | 1000 | 21 |     |    X |        host2_7500.1@mesh://10.88.0.3:37720
rv_7600.3 | mesh | 1000 | 24 |     | SLXD |                     mesh://10.88.0.2:37109
rv_7600.4 | mesh | 1000 | 26 |     |    X |        host2_7600.1@mesh://10.88.0.3:42620
      web |  web |      | 14 |     |    S |                            web://[::]:7580
10.88.0.2 | name |      | 17 |     |    S |  name://10.88.0.2:59432;239.23.22.217:8327</pre>
</div>
</div>
<div class="paragraph">
<p>The ANY specifier can either connect to a mesh or a TCP listener, depending
which is present.</p>
</div>
<div class="paragraph">
<p>The empty network does not attempt to connect to anything, but it will find
other services through existing connections.</p>
</div>
<div class="paragraph">
<p>If there exists a rv_7500 transport in the configuration (configured in rv.yaml
or the -cfg argument), this overrides any client specified network connection
for service 7500, so the client network argument is ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_peer_names">The Peer Names</h3>
<div class="paragraph">
<p>Each <code>ms_server</code> instance uses the hostname of the machine to identify itself
unless the -user argument is used to specify another name.  The daemon port
is appended to the user name so that multiple daemons appear as hostname_7500
and hostname_7600 when -listen 7500 and -listen 7600 are used for two different
daemon instances.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="console">Console</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_of_the_console">Description of the Console</h3>
<div class="paragraph">
<p>The console of <code>ms_server</code> is available when the -c option is used or when a
<a href="#telnet">Telnet</a> protocol is defined.  It offers command line editing and
completions.  It can be used to define, start, or stop connections between
instances and also modify which IPC protocols are running for clients to use.
It also has many ways to examine and debug the network.</p>
</div>
<div class="paragraph">
<p>The output is usually colorized if the terminal supports it, with green and red
used for log messages (normal and error) and white used for cli command
execution results.  Printing messages received are also colorized, green for
field name, blue for field type, white for field values.</p>
</div>
<div class="paragraph">
<p>The user names and the transport names usually have an integer number appended
to them, for example <code>lex_a2.3</code> is the user <code>lex_a2</code> that has a <code>uid</code> of 3.
This indicates either the <code>uid</code> or the <code>tport_id</code> of the identifier.  The
string identifiers of users and transports can contain duplicates, since they
are identified using the bridge id.  The bridge id is a unique random 128 bit
nonce, the strings attached to the users and transports are tags which usually
are unique, but not necessarily.  The users and transports are kept in their
respective a tables and the <code>uid</code> and <code>tport_id</code> are indexes into these tables.
The <code>*</code> is often used for uid 0 so that it stands out, since it is the peer
that the console is attached to.  The <code>tport_id</code> of 0 is also special, that is
where the client protocols are attached through local IPC, for example, a TCP
connection to 127.0.0.1:7500.</p>
</div>
<div class="paragraph">
<p>The command string entered into the cli will execute if it has enough characters
to distinguish it from the prefixes of other commands.  If the string <em>pi</em> is
entered, then the command <code>ping</code> will run, since <em>pi</em> is a unique prefix of
<code>ping</code>.  The <code>show</code> prefix is optional when the command matches the second part
of the <code>show</code> command, so <em>pe</em> will match and run the <code>show peers</code> command.
The shortened command <code>run t test</code> will match and run the <code>show running
transport test</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_help_screen">Help Screen</h3>
<div class="paragraph">
<p>The following is the help screen, displayed when "help" is entered at the cli.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ping">ping</a> [U]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ping peers and display latency of return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ping">tping</a> [U]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ping peers with route trace flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ping">mping</a> [P]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multicast ping all peers using path P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#remote">remote</a> U C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run command C remotely on peer U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conn_listen">connect</a> T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start tport connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conn_listen">listen</a> T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start tport listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conn_listen">shutdown</a> T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shutdown tport</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conn_listen">network</a> S N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure service and join network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">configure transport</a> T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure tport T</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">configure parameter</a> P V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure parameter P = V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">save</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save current config as startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_subs">show subs</a> [U] [W]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show subscriptions of peers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_seqno">show seqno</a> [W]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show subject seqno values for pub and sub</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_adjacency">show adjacency</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the adjacency links</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_peers">show peers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show active peers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_ports">show ports</a> [T]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the active ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_cost">show cost</a> [T]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the port costs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_status">show status</a> [T]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the port status with any errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_routes">show routes</a> [P]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the route for each peer for path P (0-3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_urls">show urls</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show urls of connected peers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_tport">show tport</a> [T]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the configured tports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_user">show user</a> [U]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the configured users</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_events">show events</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show event recorder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_logs">show logs</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show current log buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_counters">show counters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show system seqno and time values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_sync">show sync</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show system seqno and sums</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_pubtype">show pubtype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show system publish type received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_inbox">show inbox</a> [U]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show inbox sequences</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_loss">show loss</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show message loss counters and time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_skew">show skew</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show peer system clock skews</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_reachable">show reachable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show reachable peers through active tports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_tree">show tree</a> [U]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show multicast tree from me or U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_path">show path</a> [P]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show multicast path P (0&#8594;3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_forward">show forward</a> [P]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show forwarding P (0&#8594;3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_fds">show fds</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show fd statistics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_buffers">show buffers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show fd buffer memory usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_windows">show windows</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show pub and sub window memory usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_blooms">show blooms</a> [P]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show bloom centric routes for path P (0-3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_match">show match</a> S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show users which have a bloom that match sub</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_graph">show graph</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show network description for node graph</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_cache">show cache</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show routing cache geom, hits and misses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_poll">show poll</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show poll dispatch latency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#show_hosts">show hosts</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show rv hosts and services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show running</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show current config running</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show running transport</a> T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show transports running, T or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show running service</a> S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show services running config, S or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show running user</a> U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show users running config, U or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show running group</a> G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show groups running config, G or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show running parameter</a> P</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show parameters running config, P or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show startup</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show startup config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show startup transport</a> T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show transports startup, T or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show startup service</a> S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show services startup config, S or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show startup user</a> U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show users startup config, U or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show startup group</a> G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show groups startup config, G or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conf_tran">show startup parameter</a> P</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show parameters startup config, P or all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_sub">sub</a> S [F]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscribe subject S, output to file F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_unsub">unsub</a> S [F]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsubscribe subject S, stop output file F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_psub">psub</a> W [F]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscribe rv-wildcard W, output to file F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_punsub">punsub</a> W [F]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsubscribe rv-wildcard W, stop output file F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_gsub">gsub</a> W [F]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscribe glob-wildcard W, output to file F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_gunsub">gunsub</a> W [F]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsubscribe glob-wildcard W, stop output file F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_pub">pub</a> S M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publish msg string M to subject S</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_trace">trace</a> S M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publish msg string M to subject S, with reply</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_ack">ack</a> S M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publish msg string M to subject S, with ack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_rpc">rpc</a> S M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publish msg string M to subject S, with return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_any">any</a> S M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publish msg string M to any subscriber of S</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_cancel">cancel</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancel and show incomplete (ping, show subs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#log_mute">mute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mute the log output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#log_unmute">unmute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unmute the log output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#test_reseed">reseed</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reseed bloom filter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#debug_log">debug</a> I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set debug flags to ival I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#write_events">wevents</a> F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write events to file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#stop_die">die</a> [I]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exit without cleanup, with status 1 or I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#stop_quit">quit/exit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exit console</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The arguments in square brackets are optional, the letters used above are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>U&#8201;&#8212;&#8201;User, the name of an <code>ms_server</code> instance, which is often the hostname
of the machine.</p>
</li>
<li>
<p>P&#8201;&#8212;&#8201;Path, a multicast path, numbered 0 to 3.  This selects a precomputed
path that all <code>ms_server</code> instances use to forward messages.  It will only
be different when there are redundant links with a cost that is less or equal
to the primary path 0.</p>
</li>
<li>
<p>T&#8201;&#8212;&#8201;Transport, the name of a connection endpoint that messages are routed
through.</p>
</li>
<li>
<p>S&#8201;&#8212;&#8201;Service or Subject depending context.  The name or number of a service,
for example 7500 is the default RV service.  A subject is any string of
characters.</p>
</li>
<li>
<p>N&#8201;&#8212;&#8201;Network, formatted described in <a href="#network_spec">Connecting to Networks</a>.</p>
</li>
<li>
<p>G&#8201;&#8212;&#8201;Group, defines a group of users, not currently used.</p>
</li>
<li>
<p>F&#8201;&#8212;&#8201;File, a path in the file system.</p>
</li>
<li>
<p>M&#8201;&#8212;&#8201;Message, a string of characters, as the console is limited to message
formats that can be typed into the cli (string and json).</p>
</li>
<li>
<p>I&#8201;&#8212;&#8201;Integer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ping">Testing Connectivity with Ping</h3>
<div class="ulist">
<ul>
<li>
<p>ping [U]</p>
</li>
<li>
<p>tping [U]</p>
</li>
<li>
<p>mping [P]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands send a message to a peer and display the message returned.  The
<code>tping</code> command also sets the trace flag in the message sent so that all peers
along the path will also send a message back.  This is useful in the way that
traceroute is useful, to find an unusual latency report or dropped messages.</p>
</div>
<div class="paragraph">
<p>The <code>ping</code> and <code>tping</code> optionally have an argument that specifies the name of
the peer to send the message.  If no argument is used, then every peer
currently active will be sent a message.  These messages are sent over the link
that is handling the inbox point to point messages.  The subject of a <code>ping</code>
message uses the inbox format <code>_I.&lt;nonce&gt;.ping</code>, where the nonce identifies the
destination peer.  The return uses the <code>_I.&lt;nonce&gt;.N</code> inbox subject, where
nonce identifies the peer of the sending console.  The N part of the subject is
setup by the console to identify what the sending operation was and is used in
the reply field of the original message.</p>
</div>
<div class="paragraph">
<p>The <code>mping</code> use a multicast path instead of an inbox path.  The multicast path
is numbered and is added to the message header so that all peers which receive
and route this message will use the same path.  All peers that receive it will
send an inbox reply message, similar to <code>ping</code>.  The subject used by the sender
is <code>_M.ping</code>, which all peers are subscribed to.  The multicast paths are
numbered 0 to 3, so <code>mping 0</code> will use the first path, and <code>mping 3</code> will use
the last path.  Using different paths can be useful to check that all redundant
links in use are active and forwarding.  The reply also includes which port the
message was received on, which will match the path 3 network path.  The path 0
is often the same as the inbox path, except in the case of PGM, where inbox is
a UDP point to point protocol.</p>
</div>
<div class="paragraph">
<p>If the network is not yet stable, sometimes a ping operation will not complete.
When this occurs, use the <code>cancel</code> command to show the completed and the
incomplete values.  When a ping operation is started, the console estimates
the number of replies that are expected and waits for these to complete before
displaying the results.   The <code>tping</code> will display the acks of the message
as they are received but wait for the final results.</p>
</div>
<div class="paragraph">
<p>Example <code>ping</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[0]&gt; ping
   user   | cost |   lat |     tport   |  peer_tport
----------+------+-------+-------------+-------------
 pic_a2.1 | 1000 | 189us | pic_amesh.2 |  pic_amesh.2
 pic_a4.3 | 1000 | 184us | pic_amesh.4 |  pic_amesh.4
 pic_a3.2 | 1000 | 214us | pic_amesh.3 |  pic_amesh.3
  pic_a.4 | 1000 | 219us | pic_amesh.5 |  pic_amesh.6
 lex_a.29 | 2000 | 296us | pic_amesh.5 |   fo_mesh.12
 lee_a.26 | 2000 | 340us | pic_amesh.5 |   fo_mesh.12
lex_a4.17 | 3000 | 389us | pic_amesh.5 |  lex_amesh.5
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>mping</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[1]&gt; mping 1
   user   | cost |   lat  |     tport   |  peer_tport
----------+------+--------+-------------+-------------
  pic_a.4 | 1000 |  146us | pic_amesh.5 |  pic_amesh.6
 pic_a2.1 | 1000 |  158us | pic_amesh.2 |  pic_amesh.2
 pic_a4.3 | 1000 |  199us | pic_amesh.4 |  pic_amesh.4
 pic_a3.2 | 1000 |  245us | pic_amesh.3 |  pic_amesh.3
  edo_a.9 | 2000 |  265us | pic_amesh.5 |   fo_mesh.12
 lex_a.29 | 2000 |  278us | pic_amesh.5 |   fo_mesh.12
 lee_a.26 | 2000 |  279us | pic_amesh.5 |   fo_mesh.12
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>tport</code> field is where the reply inbox message was received, the
<code>peer_tport</code> is where the <code>ping</code> message was received at the peer.</p>
</div>
</div>
<div class="sect2">
<h3 id="remote">Remote Command Execution</h3>
<div class="ulist">
<ul>
<li>
<p>remote U C</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Remote</code> will message a command to another peer, run it in it&#8217;s console and
return the result.  This is useful because most often, a peer will not have a
console, a web interface, or a telnet protocol active.  Without <code>remote</code>, the
peer would need to be restarted in order to change the configuration or start a
console.  With <code>remote</code>, you could connect a peer with authentication, encryption
and a console to the network temporarily, make a change, then disconnect the
peer.</p>
</div>
<div class="paragraph">
<p>Example of <code>remote</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[4]&gt; rem lee_a1 show pubtype
from lee_a1.19:
      type       | recv_count | send_count
-----------------+------------+-----------
 u_session_hello |          0 |          1
    u_session_hb |      16217 |      16218
      u_peer_add |        113 |         31
  u_bloom_filter |         39 |          3
     u_adjacency |         67 |          4
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conf_tran">Update and Show the Configuration</h3>
<div class="ulist">
<ul>
<li>
<p>configure transport T</p>
</li>
<li>
<p>configure parameter P V</p>
</li>
<li>
<p>save</p>
</li>
<li>
<p>show running</p>
</li>
<li>
<p>show running transport T</p>
</li>
<li>
<p>show running service S</p>
</li>
<li>
<p>show running user U</p>
</li>
<li>
<p>show running group G</p>
</li>
<li>
<p>show running parameter P</p>
</li>
<li>
<p>show startup</p>
</li>
<li>
<p>show startup transport T</p>
</li>
<li>
<p>show startup service S</p>
</li>
<li>
<p>show startup user U</p>
</li>
<li>
<p>show startup group G</p>
</li>
<li>
<p>show startup parameter P</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands show and modify the running configuration.  The <code>save</code> command
write the running config to the startup config, when the directory and files
are writable.</p>
</div>
<div class="paragraph">
<p>The <code>show running</code> and <code>show startup</code> will print the config tree in yaml
to the console.  The running configuration may have some dynamically created
users and protocols which are created as a result of the startup config.  A
dynamically created user that is not preconfigured is one of these.  These
will show in <code>running</code>, but will not save to <code>startup</code>.</p>
</div>
<div class="paragraph">
<p>Using the <code>configure transport</code> command is the most often used command of
these.  It will update the currently running transports as well as add new
ones.  If it is used to modify an existing transport that is already running,
the new settings won&#8217;t change the active transport until it is restarted
with <code>shutdown</code> and <code>connect</code> or <code>listen</code>.  The configuration details of
transports are described in <a href="#network">Networking</a>, and the details of the parameters
are described in <a href="#parameters">Parameters</a>.  Most of the parameters are only applied
at startup, so changing them will have an effect only when saved and the
process restarted.</p>
</div>
<div class="paragraph">
<p>Example of <code>configure transport</code> and <code>show running transport</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[110]&gt; configure transport mesh
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[111](mesh)&gt; type mesh
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[112](mesh)&gt; port 9000
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[113](mesh)&gt; connect host1
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[114](mesh)&gt; connect2 host2
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[115](mesh)&gt; listen *
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[116](mesh)&gt; q
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[117]&gt; show running transports mesh
transports:
  - tport: mesh
    type: mesh
    route:
      port: 9000
      connect: host1
      connect2: host2
      listen: "*"
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[123]&gt; configure transport test type tcp port 9000 connect host1
Transport (test) updated
chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[124]&gt; show running transports test
transports:
  - tport: test
    type: tcp
    route:
      port: 9000
      connect: host1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first <code>configure</code> command enters into a cli sub command mode where only the
fields of the transport can be entered.  The second <code>configure</code> command sets
all of the fields on one line.</p>
</div>
<div class="paragraph">
<p>The commands <code>show service</code> and <code>show group</code> have limited usefulness at in the
current implementation, since only one service is used per <code>ms_server</code> instance
and groups do not have operational functionality yet, eventually they will be
used for access control lists.</p>
</div>
</div>
<div class="sect2">
<h3 id="conn_listen">Transport Start and Stop</h3>
<div class="ulist">
<ul>
<li>
<p>connect T</p>
</li>
<li>
<p>listen T</p>
</li>
<li>
<p>shutdown T</p>
</li>
<li>
<p>network S N</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The transport T is defined before using the <code>connect</code>, <code>listen</code>, <code>shutdown</code>
commands.  The <code>network</code> command configures the transport if not already
configured, runs it, and also attaches a service to it.  The configuration of
the transports is described in <a href="#network">Networking</a>.</p>
</div>
<div class="paragraph">
<p>Example of <code>connect</code>, <code>listen</code>, <code>shutdown</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>chex.rvd[L+jUn266ADoL2fBschoqUg]@chex[108]&gt; configure transport test type tcp port 9000 connect lexx.rai
Transport (test) updated
chex.rvd[L+jUn266ADoL2fBschoqUg]@chex[109]&gt; connect test
Transport (test) started connecting
chex.rvd[L+jUn266ADoL2fBschoqUg]@chex[110]&gt; shutdown test
Transport (test) is running tport 1
Transport (test) shutdown (1 instances down)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_show_commands">The Show Commands</h3>
<div id="show_subs" class="ulist">
<ul>
<li>
<p>show subs [U] [W]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the subscriptions active for user or for all users.  The <code>W</code> is a substring
for partial matches.  This command uses inbox RPC calls to <code>_I.&lt;nonce&gt;.subs</code>
for all users which <code>U</code> specifies.  The <code>*</code> user matches all users, so the <code>W</code>
argument can be specified.</p>
</div>
<div class="paragraph">
<p>Example, show all subscriptions for every user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[38]&gt; show subs
   user   |                               subject
----------+-------------------------------------------------------------------
 pic_a1.* |                                       _7603._INBOX.0AB98FB4.DAEMON
          |                       (p) _7603._INBOX.0AB98FB4.763E17AA51E2DEF0.&gt;
          |                                                               test
----------+-------------------------------------------------------------------
 pic_a2.1 |                                       _7606._INBOX.173D29A5.DAEMON
          |                       (p) _7606._INBOX.173D29A5.763E17AA5271FEF0.&gt;
----------+-------------------------------------------------------------------
 pic_a3.2 |                                       _7500._INBOX.0072DD0A.DAEMON
          |                       (p) _7500._INBOX.0072DD0A.663E17AA514B7DD0.&gt;
          |                                               _7500.RSF3.REC.MOT.B
----------+-------------------------------------------------------------------
 pic_a4.3 |                                       _7500._INBOX.68AD2F1B.DAEMON
          |                       (p) _7500._INBOX.68AD2F1B.763E17AA50777DD0.&gt;
          |                                            _7500.RSF4.REC.DEM=.NaE
          |                                             _7500.RSF4.REC.NAI.NaE
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>(p)</code> strings before the subject indicates that the subject was subscribed
as a pattern.</p>
</div>
<div class="paragraph">
<p>Example, show all subscriptions which have the substring DAEMON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[41]&gt; show subs * DAEMON
   user   |            subject
----------+-----------------------------
 pic_a1.* | _7603._INBOX.0AB98FB4.DAEMON
----------+-----------------------------
 pic_a2.1 | _7606._INBOX.173D29A5.DAEMON
----------+-----------------------------
 pic_a3.2 | _7500._INBOX.0072DD0A.DAEMON
----------+-----------------------------
 pic_a4.3 | _7500._INBOX.68AD2F1B.DAEMON
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example, show subscriptions active at user edo_a3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[44]&gt; show subs edo_a3
   user   |                    subject
----------+---------------------------------------------
edo_a3.13 |                 _7500._INBOX.C6AD7566.DAEMON
          | (p) _7500._INBOX.C6AD7566.763E17AA40C28DD0.&gt;
          |                          _7500.RSF5.REC.DD.N
          |                         _7500.RSF5.REC.BBN.N
...</code></pre>
</div>
</div>
<div id="show_seqno" class="ulist">
<ul>
<li>
<p>show seqno [W]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the sequences of the subjects received and published.  The peers with IPC
or console subscribers or publishers track the sequences the subjects to ensure
the stream is completely serialized and notify of a data loss error when it is
not in sequence.  The details of how this works is described in
<a href="#message_loss">Message Loss</a>.  This command only operates on the local sequence windows,
the <a href="#show_windows">show windows</a> command shows the memory usage of these.</p>
</div>
<div class="paragraph">
<p>The W is a substring that matches the subject so that the subjects in the
window can be filtered.  Without <code>W</code>, all of the subjects are printed.</p>
</div>
<div class="paragraph">
<p>Example, show the sequences of the subjects which contain ORCL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[4]&gt; show seqno ORCL
  source   |  seqno |        start      |        time       |         subject
-----------+--------+-------------------+-------------------+---------------------------
       ipc |  52581 | 0207 10:16:16.108 | 0207 23:51:11.441 |      _7500.RSF4.REC.ORCL.O
       ipc | 145911 | 0207 10:20:50.986 | 0208 00:07:24.401 |      _7500.RSF9.REC.ORCL.O
       ipc | 128244 | 0207 10:25:25.864 | 0208 00:17:18.041 |      _7500.RSF7.REC.ORCL.O
 dex_a2.21 | 542769 | 0207 10:03:05.834 | 0208 00:22:42.401 | _7605._TIC.RSF5.REC.ORCL.O
 dex_a1.20 | 542769 | 0207 10:03:05.834 | 0208 00:22:42.281 | _7602._TIC.RSF2.REC.ORCL.O
 ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The source is the publisher, so IPC indicates that the client attached to the
lex_a1 has published these messages, and dex_a2, dex_a1 indicate that these
messages were received from clients attached to those peers (or the console).
The start is the first time in the time frame that the subject was seen, the
time is the last time it was seen.  New time frames occur when the network link
state database changes, since the sequence number time frame reference jump
between old and new time frames and the seqno base is linear.</p>
</div>
<div id="show_adjacency" class="ulist">
<ul>
<li>
<p>show adjacency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the adjacency tables.  This command dumps the current link state database.
It shows which peer has a link to another peer through which tport and the cost
of the link (of path 0).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>chex.rvd[LQ9YfNwX/KtuiniQNvVkQg]@chex[127]&gt; show adj
   user    |     adj    |     tport    | type | cost
-----------+------------+--------------+------+-----
    chex.* |            |        ipc.0 |  ipc | 1000
           |    lex_a.1 |       test.1 |  tcp | 1000
-----------+------------+--------------+------+-----
   lex_a.1 |    edo_a.2 |    fo_mesh.4 | mesh | 1000
           |   lex_a2.3 |  lex_amesh.5 | mesh | 1000
           |   lex_a1.4 |  lex_amesh.6 | mesh | 1000
           |   lex_a3.5 |  lex_amesh.7 | mesh | 1000
           |   lex_a4.6 |  lex_amesh.8 | mesh | 1000
           |   robo_a.7 |    fo_mesh.9 | mesh | 1000
           |   lee_a.16 |   fo_mesh.10 | mesh | 1000
           |   dex_a.21 |   fo_mesh.11 | mesh | 1000
           |   pic_a.26 |   fo_mesh.12 | mesh | 1000
           |     chex.* |   lex_tcp.13 |  tcp | 1000
-----------+------------+--------------+------+-----
   edo_a.2 |   edo_a4.8 |  edo_amesh.4 | mesh | 1000
           |   edo_a3.9 |  edo_amesh.5 | mesh | 1000
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>user</code> is the peer that is maintaining the links that follow.  It sends a
link state update messages when a link is added, dropped or cost is changed.</p>
</div>
<div class="paragraph">
<p>The <code>adj</code> field is the peer which is directly attached to <code>user</code> through the
<code>tport</code>.  The <code>tport</code> is the name that <code>user</code> is labeling this link.  The
<code>tport_id</code> number that follows the name (<code>fo_mesh</code> + .4) is the index into the
user&#8217;s transport table.  The <code>type</code> and <code>cost</code> fields are also sent by <code>user</code>
in the link state update.</p>
</div>
<div id="show_peers" class="ulist">
<ul>
<li>
<p>show peers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Shows info about the peers in the network that are active.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>   user    |         bridge         | sub |  seq | link |   lat |   max |   avg |        start      |     tport   | cost
-----------+------------------------+-----+------+------+-------+-------+-------+-------------------+-------------+-----
  pic_a1.* | zD1mbc/elMr2GJ/v+vx9hA |   4 |    2 |    8 |       |       |       | 0224 11:31:35.247 |             |
  pic_a2.1 | fiZzmz7UlHLLyCEum+mbpQ |   4 |    2 |    8 | 226us | 296us | 182us | 0224 11:31:35.806 | pic_amesh.2 | 1000
  pic_a3.2 | zv2CyNOl+2TZotZhL3iEwA |  75 | 8617 |    8 | 246us | 409us | 231us | 0224 11:31:36.381 | pic_amesh.3 | 1000
  pic_a4.3 | JN3DyA6dXDMsh9kOtdFi7Q |  13 | 8553 |    8 | 167us | 288us | 225us | 0224 11:31:36.960 | pic_amesh.4 | 1000
   pic_a.4 | ikdNy92Qp/gHbBger09G6g |   2 |    0 |   17 | 109us | 538us | 183us | 0224 11:31:36.988 | pic_amesh.5 | 1000
  robo_a.5 | WnC1wQLMzxxKeP/55Y2cHA |   2 |    0 |   18 | 453us | 708us | 427us | 0224 11:31:27.442 | pic_amesh.5 | 2000
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>bridge</code> is the 128 bit random nonce created on startup by each peer.  It
uniquely identifies the peer instance.</p>
</div>
<div class="paragraph">
<p>The <code>sub</code> field are the number of subscriptions that are active.  This number is
a counter in the bloom filter that is updated by the peer when subjects and
patterns are added or removed.  It always contains at least 2 entries, one for
the <code>_I.&lt;nonce&gt;.&gt;</code> inbox pattern and one for the <code>_M.&gt;</code> multicast pattern.</p>
</div>
<div class="paragraph">
<p>The <code>seq</code> field is the sequence number for each subscription operation.  It is
serialized so that all subscriptions happen in the same order as the peer.</p>
</div>
<div class="paragraph">
<p>The <code>link</code> field is the sequence number for each link state update.  It is also
serialized so that adjacency table modifications occur in order.</p>
</div>
<div class="paragraph">
<p>The <code>lat</code>, <code>max</code>, <code>avg</code> are ping round trip times that are sent 1.5x the
heartbeat interval to a random peer.  They are tracked for at least an hour
before being rotated.</p>
</div>
<div class="paragraph">
<p>The <code>start</code> is the start time of the peer.</p>
</div>
<div class="paragraph">
<p>The <code>tport</code> and <code>cost</code> reference the inbox route to peer.</p>
</div>
<div class="paragraph">
<p>The order in the table is by uid.  Using the <code>show peers nonce</code> orders the
table by bridge nonce, <code>show peers start</code> orders the table by start time,
<code>show peers user</code> orders the table by user name.  The <code>show peers host</code> shows
the first 4 bytes of the bridge used as the host id and <code>show peers ip</code> shows
the first 4 bytes of the bridge in IPv4 dotted quad format.</p>
</div>
<div class="paragraph">
<p>Using <code>show peers zombie</code>, the dead peers are displayed.</p>
</div>
<div id="show_ports" class="ulist">
<ul>
<li>
<p>show ports [T]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show info about transports that are active on the network.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[47]&gt; show ports
    tport   |  type  | cost | fd |      bs     |    br    |     ms    |   mr   |   lat |  idle  |  fl  |                   address
------------+--------+------+----+-------------+----------+-----------+--------+-------+--------+------+-------------------------------------------
       rv.0 |     rv |      | 12 |             |          |           |        |       | 27.8hr |   LI |                        rv://127.0.0.1:7500
pic_amesh.1 |   mesh | 1000 | 18 |             |          |           |        |       | 27.8hr | LXCD |                    mesh://172.18.0.2:34344
pic_amesh.2 |   mesh | 1000 | 19 |     3250008 |  3248028 |     10747 |  10747 | 173us | 1.99se |    X |           pic_a2.1@mesh://172.18.0.3:39340
pic_amesh.3 |   mesh | 1000 | 21 |     3248424 |  5785922 |     10733 |  32929 | 240us | 1.39se |    X |           pic_a3.2@mesh://172.18.0.4:41320
pic_amesh.4 |   mesh | 1000 | 23 |     3355474 |  5801830 |     10822 |  33084 | 225us |  835ms |    X |           pic_a4.3@mesh://172.18.0.5:43846
pic_amesh.5 |   mesh | 1000 | 25 | 36957142584 | 29991114 | 100159342 | 245786 | 166us | 1.06ms |    X |            pic_a.4@mesh://172.18.0.1:57204</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>tport</code>, <code>type</code> are configured, and the <code>cost</code> is either configured or
advertised by the peer in it&#8217;s link state message.  If a transport is internal,
like an IPC transport, then it doesn&#8217;t have a cost associated with it.</p>
</div>
<div class="paragraph">
<p>The <code>fd</code> field is the endpoint for the transport, usually a listener or a <code>fd</code>
assigned to the transport.  There are usually one or more fds within the
transport that carry out the reading and writing of data to a network endpoint.</p>
</div>
<div class="paragraph">
<p>The fields <code>bs</code>, <code>br</code>, <code>ms</code>, and <code>mr</code> fields are bytes, messages sent and
received, which are collected from all the fds within the transport.</p>
</div>
<div class="paragraph">
<p>The <code>idle</code> is the last time a message event occurred.</p>
</div>
<div class="paragraph">
<p>The <code>fl</code> field are flags that are set on the transport.  Each character is a
different flag:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>L</code>&#8201;&#8212;&#8201;has a TCP listener</p>
</li>
<li>
<p><code>M</code>&#8201;&#8212;&#8201;is a PGM multicast transport</p>
</li>
<li>
<p><code>X</code>&#8201;&#8212;&#8201;is a mesh transport</p>
</li>
<li>
<p><code>C</code>&#8201;&#8212;&#8201;is or was actively connecting the link</p>
</li>
<li>
<p><code>T</code>&#8201;&#8212;&#8201;was accepted from a TCP listener</p>
</li>
<li>
<p><code>E</code>&#8201;&#8212;&#8201;is marked as an edge link, there is no routing on the other side</p>
</li>
<li>
<p><code>I</code>&#8201;&#8212;&#8201;is an IPC transport, which is are client endpoints</p>
</li>
<li>
<p><code>D</code>&#8201;&#8212;&#8201;resolves the link using a multicast device</p>
</li>
<li>
<p><code>-</code>&#8201;&#8212;&#8201;is shutdown</p>
</li>
<li>
<p><code>*</code>&#8201;&#8212;&#8201;connecting in progress</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>address</code> field is the address at the peer when TCP is used and the
multicast address when PGM is used.</p>
</div>
<div id="show_cost" class="ulist">
<ul>
<li>
<p>show cost [T]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is similar to <a href="#show_ports">show ports</a> except that all 4 costs are
printed for each transport.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[49]&gt; show cost pic_amesh
    tport   |  type  | cost | cost2 | cost3 | cost4 | fd |  fl  |                   address
------------+--------+------+-------+-------+-------+----+------+-------------------------------------------
pic_amesh.1 |   mesh | 1000 |  1000 |  1000 |  1000 | 18 | LXCD |                    mesh://172.18.0.2:34344
pic_amesh.2 |   mesh | 1000 |  1000 |  1000 |  1000 | 19 |    X |           pic_a2.1@mesh://172.18.0.3:39340
pic_amesh.3 |   mesh | 1000 |  1000 |  1000 |  1000 | 21 |    X |           pic_a3.2@mesh://172.18.0.4:41320
pic_amesh.4 |   mesh | 1000 |  1000 |  1000 |  1000 | 23 |    X |           pic_a4.3@mesh://172.18.0.5:43846
pic_amesh.5 |   mesh | 1000 |  1000 |  1000 |  1000 | 25 |    X |            pic_a.4@mesh://172.18.0.1:57204
...</code></pre>
</div>
</div>
<div id="show_status" class="ulist">
<ul>
<li>
<p>show status [T]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to <a href="#show_ports">show ports</a> with a status errno if the system
reported an error on a link.  When everything is normal, the address is printed
instead.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[50]&gt; show status pic_amesh
    tport   | type | fd |  fl  |              status
------------+------+----+------+---------------------------------
pic_amesh.1 | mesh | 18 | LXCD | mesh://172.18.0.2:34344
pic_amesh.2 | mesh | 19 |    X | pic_a2.1@mesh://172.18.0.3:39340
pic_amesh.3 | mesh | 21 |    X | pic_a3.2@mesh://172.18.0.4:41320
pic_amesh.4 | mesh | 23 |    X | pic_a4.3@mesh://172.18.0.5:43846
pic_amesh.5 | mesh | 25 |    X | pic_a.4@mesh://172.18.0.1:57204
...</pre>
</div>
</div>
<div id="show_routes" class="ulist">
<ul>
<li>
<p>show routes [P]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the routes.  This shows how all the peers are connected and which port
would be used to send and receive messages to/from the peer.  It also displays
which transports have been used in order to reach the peer.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[52]&gt; show routes
   user   |     tport   |      state    | cost |   path  |   lat  | fd |               route
----------+-------------+---------------+------+---------+--------+----+---------------------------------
 pic_a2.1 | pic_amesh.2 | inbox,mesh,hb | 1000 | 0,1,2,3 |  143us | 19 | pic_a2.1@mesh://172.18.0.3:39340
          | pic_amesh.3 |               | 2000 |         |        | 21 | pic_a3.2@mesh://172.18.0.4:41320
          | pic_amesh.4 |               | 2000 |         |        | 23 | pic_a4.3@mesh://172.18.0.5:43846
          | pic_amesh.5 |               | 2000 |         |        | 25 |  pic_a.4@mesh://172.18.0.1:57204
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that user <code>pic_a2</code> messages have been received or sent through these
transports.  The secondary transports are often used on startup when the other
links are not yet active or when a link fails.</p>
</div>
<div class="paragraph">
<p>The <code>state</code> of the transport has these values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>inbox</code>&#8201;&#8212;&#8201;transport is the path for the inbox route</p>
</li>
<li>
<p><code>mesh</code>&#8201;&#8212;&#8201;transport is part of a mesh</p>
</li>
<li>
<p><code>hb</code>&#8201;&#8212;&#8201;transport is directly connected and has a heartbeat</p>
</li>
<li>
<p><code>ucast</code>&#8201;&#8212;&#8201;transport has a point to point UDP protocol</p>
</li>
<li>
<p><code>usrc</code>&#8201;&#8212;&#8201;transport uses a point to point UDP protocol to reach another peer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>cost</code> is the link cost of the path P argument, or 0 when not specified.</p>
</div>
<div class="paragraph">
<p>The <code>path</code> field enumerates which transport is used to reach peer for each path.</p>
</div>
<div class="paragraph">
<p>The <code>lat</code>, <code>fd</code> are the same as <a href="#show_ports">show ports</a>.</p>
</div>
<div class="paragraph">
<p>The <code>route</code> is the directly connected peer address that a message is sent or
received.</p>
</div>
<div id="show_urls" class="ulist">
<ul>
<li>
<p>show urls</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the local and peer addresses as well as the url used to resolve the
address of the peer.  This is useful for mesh and multicast type networks since
the endpoints are sometimes resolved through exchanging messages with the
network.   In the case of a mesh transport, a mesh url database is exchanged
and links are established with all the peers that are in the mesh.  The
multicast PGM transport exchanges the unicast UDP endpoints for all the peers
that are on the transport.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[54]&gt; show urls
   user   |     tport   |      state    | cost |    mesh   | fd |            url          |           local         |          remote
----------+-------------+---------------+------+-----------+----+-------------------------+-------------------------+------------------------
          |       ipc.0 |            LI |      |           | 11 |                         |    ipc://127.0.0.1:7500 |   ipc://127.0.0.1:43992
          | pic_amesh.1 |          LXCD |      | pic_amesh | 17 | mesh://172.18.0.2:34344 |                         |
 pic_a2.1 | pic_amesh.2 |             X |      | pic_amesh | 20 | mesh://172.18.0.3:44108 | mesh://172.18.0.2:34344 | mesh://172.18.0.3:39340
 pic_a3.2 | pic_amesh.3 |             X |      | pic_amesh | 22 | mesh://172.18.0.4:42851 | mesh://172.18.0.2:34344 | mesh://172.18.0.4:41320
 pic_a4.3 | pic_amesh.4 |             X |      | pic_amesh | 24 | mesh://172.18.0.5:45836 | mesh://172.18.0.2:34344 | mesh://172.18.0.5:43846
  pic_a.4 | pic_amesh.5 |             X |      | pic_amesh | 26 | mesh://172.18.0.1:36262 | mesh://172.18.0.2:34344 | mesh://172.18.0.1:57204
----------+-------------+---------------+------+-----------+----+-------------------------+-------------------------+------------------------
 pic_a2.1 | pic_amesh.2 | inbox,mesh,hb | 1000 | pic_amesh | 19 | mesh://172.18.0.3:44108 | mesh://172.18.0.2:34344 | mesh://172.18.0.3:39340
          | pic_amesh.3 |               | 2000 | pic_amesh | 21 |                         |                         |
          | pic_amesh.4 |               | 2000 | pic_amesh | 23 |                         |                         |
          | pic_amesh.5 |               | 2000 | pic_amesh | 25 |                         |                         |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The top section is similar to <a href="#show_ports">show ports</a> with addition of the
urls.</p>
</div>
<div class="paragraph">
<p>The following sections is similar to <a href="#show_routes">show routes</a> with the
addition of the urls for each user.</p>
</div>
<div class="paragraph">
<p>The <code>url</code> field is resolved by exchanging messages.  The <code>local</code> and <code>remote</code>
are addresses assigned to the connection.  Since a mesh may be actively
connected by either peer, since all peers passive listeners and some have
active connections.  The newer peers will usually have the active connections
and the older peers will have accepted connections.  The local and remote
addresses will reflect that, since the accepted peers are assigned an address
by the system and the connecting peers use the <code>url</code> address to connect.</p>
</div>
<div id="show_tport" class="ulist">
<ul>
<li>
<p>show tport [T]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the state of the transports.  This prints the configured transport and
whether it is active or not.  The other transport <code>show</code> commands will only
show the active transports.  This will show the ones configured but not active
as well.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[55]&gt; show tport
   tport  |  type  |    state  |        listen       |             connect            |    device
----------+--------+-----------+---------------------+--------------------------------+------------
pic_amesh |   mesh | accepting |                     |                                | mesh://eth0
       rv |     rv | accepting | rv://127.0.0.1:7500 |                                |
      tel | telnet | accepting |     telnet://*:2222 |                                |
      ipc |    ipc |       ipc |                     |                                |
  rvd.ipc |    ipc |         - |                     |                                |
     eth0 |   name |         - |                     | name://eth0;239.23.22.217:8327 |
     test |    tcp |         - |                     |        tcp://robotron.rai:9000 |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>listen</code>, <code>connect</code>, and <code>device</code> fields show how the transport is
configured to resolve the connections.</p>
</div>
<div id="show_user" class="ulist">
<ul>
<li>
<p>show user [U]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the users configured.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>chex.test[OsGpIaCbYCJbhnUVEp19Uw]@chex[135]&gt; show users
uid | user |  svc |        create        | expires
----+------+------+----------------------+--------
  0 | chex | test | 1675847381.440084399 |
    | dyna | test | 1675847381.440129724 |
    | ruby | test | 1675847381.440176492 |
    | zero | test | 1675847419.072423168 |</code></pre>
</div>
</div>
<div id="show_events" class="ulist">
<ul>
<li>
<p>show events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The system tracks the authentication and transport and link state events in a
buffer that rotates every 4096 entries.  This is a compact table that has 6
integer fields that map to a time stamp, uids, transports and enumerated values
depending on event type.  These events are useful for resolving what happened
to the network after something went wrong.</p>
</div>
<div class="paragraph">
<p>Example of an event log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[59]&gt; show events
       stamp      |     tport   |    user   |    peer   |       event     |         data
------------------+-------------+-----------+-----------+-----------------+--------------------
0206 22:09:22.606 |             |  pic_a1.* |           |         startup |
0206 22:09:22.607 |       ipc.0 |  pic_a1.* |           |      on_connect |              listen
0206 22:09:22.607 | pic_amesh.1 |  pic_a1.* |     (aes) |      on_connect |              listen
0206 22:09:22.607 |     (mcast) |  pic_a1.* |           |      send_hello |
0206 22:09:23.301 | pic_amesh.2 |  pic_a1.* |     (aes) |      on_connect |         mesh_accept
0206 22:09:23.327 |             |  pic_a1.* |           |        converge |           add_tport
0206 22:09:23.340 | pic_amesh.2 |  pic_a2.1 |  pic_a1.* |  add_user_route |            neighbor
0206 22:09:23.340 | pic_amesh.2 |  pic_a1.* |  pic_a2.1 |  send_challenge |               hello
0206 22:09:23.342 | pic_amesh.2 |  pic_a2.1 |           |  recv_challenge |           handshake
0206 22:09:23.342 |             |  pic_a2.1 |    (ecdh) |        auth_add |           handshake
0206 22:09:23.342 |     (mcast) |  pic_a1.* |  pic_a2.1 | send_adj_change |                 add
0206 22:09:23.342 | pic_amesh.2 |  pic_a2.1 |           |      send_trust |             in_mesh
0206 22:09:23.342 | pic_amesh.2 |  pic_a2.1 |           |    recv_peer_db |           add_route
0206 22:09:23.342 | pic_amesh.2 |  pic_a2.1 |  pic_a1.* | recv_adj_change |          update_adj
0206 22:09:23.367 |             |  pic_a1.* |           |        converge |          adj_change
0206 22:09:23.889 | pic_amesh.3 |  pic_a1.* |     (aes) |      on_connect |         mesh_accept
0206 22:09:23.927 |             |  pic_a1.* |           |        converge |           add_tport
0206 22:09:23.928 | pic_amesh.3 |  pic_a3.2 |  pic_a1.* |  add_user_route |            neighbor</code></pre>
</div>
</div>
<div class="paragraph">
<p>The events that are logged are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial event, time of start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on_connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport listen, connect, or accept occurred</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on_shutdown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport connection was closed or shutdown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">on_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport connection timed out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth_add</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer was authenticated and is now trusted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth_remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer authentication is dropped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_challenge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An authentication challenge is sent to peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_challenge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An authentication challenge is received from peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_trust</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication was successful, sent trust message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_trust</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer notified that my node is now authenticated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add_user_route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Route to peer is found and the transport is labeled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hb_queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer is added to the heartbeat timeout queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hb_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer heartbeat was not received within it&#8217;s interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_hello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport is initialized by sending a hello message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_bye</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer intends to leave the network and sends a bye message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_add_route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received a message that a peer was added to the network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_peer_db</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the peers that are known are exchanged with a new peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_add_route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send a message when a peer is added to the network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_peer_del</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send a message when peer is removed from the network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sync_result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer sync message was received, initialize peer state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request a peer sync after new peer is notified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_sync_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive a sync request for my node or another peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_sync_fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive a sync request for an unknown peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_adj_change</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send a link state update message, add or remove link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_adj_change</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received a link state update message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_adj_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link state for peer is stale, request the current link state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_adj_req</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive a request for the current link state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send_adj</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send the current link state to a peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_adj_result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive the current link state from a peer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resize_bloom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resize my peers bloom filter and sent it to the network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv_bloom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Received a peers bloom filter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">converge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The network has no missing link states and is completely connected</p></td>
</tr>
</tbody>
</table>
<div id="show_logs" class="ulist">
<ul>
<li>
<p>show logs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last log 64K bytes of the log is buffered in the process.  This command
shows the this buffer.</p>
</div>
<div id="show_counters" class="ulist">
<ul>
<li>
<p>show counters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the counters of heartbeat, inbox, and ping subjects.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>pic_a1.rvd[CrmPtIc8B3ZedgdVTW7XOQ]@pic_a1[60]&gt; show counters
   user   |        start      | hb seqno |       hb time     | snd ibx | rcv ibx | ping snd |     ping stime    | pong rcv | ping rcv
----------+-------------------+----------+-------------------+---------+---------+----------+-------------------+----------+---------
 pic_a1.* | 0206 22:09:22.606 |          |                   |         |         |          |                   |          |
 pic_a2.1 | 0206 22:09:23.219 |    17021 | 0208 20:52:00.940 |      19 |      23 |      454 | 0208 20:50:22.608 |      454 |      442
 pic_a3.2 | 0206 22:09:23.806 |    17021 | 0208 20:51:51.687 |      18 |     149 |      438 | 0208 20:50:43.808 |      438 |      444
 pic_a4.3 | 0206 22:09:24.401 |    17020 | 0208 20:51:52.241 |      29 |     125 |      427 | 0208 20:51:00.008 |      427 |      438
  pic_a.4 | 0206 22:09:24.433 |    17020 | 0208 20:51:52.275 |      35 |      37 |      422 | 0208 20:51:21.608 |      422 |      426
robo_a3.5 | 0206 22:09:06.260 |        0 |                   |      11 |      98 |      427 | 0208 20:51:40.528 |      427 |      421
robo_a2.6 | 0206 22:09:05.371 |        0 |                   |      11 |      15 |      424 | 0208 20:51:50.168 |      424 |      423
robo_a4.7 | 0206 22:09:07.183 |        0 |                   |      11 |      95 |      420 | 0208 20:41:30.568 |      420 |      418
robo_a1.8 | 0206 22:09:04.452 |        0 |                   |      11 |      15 |      423 | 0208 20:41:48.848 |      423 |      424
  edo_a.9 | 0206 22:09:12.993 |        0 |                   |       2 |      20 |      422 | 0208 20:42:05.808 |      422 |      419
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> field is when the process started.  The <code>hb seqno</code> and <code>hb time</code>
track the last heartbeat received from the peer when it is directly connected.
The <code>snd ibx</code>, <code>rcv ibx</code> are counters for many of the <code>_I.&lt;nonce&gt;.</code> subjects
which guard against repeats.  These are point to point messages, the peer has
the same counters which should match these.  The <a href="#show_inbox">show inbox</a>
command will show the last 32 of these sequences.  The <code>ping</code> and <code>pong</code>
sequences have their own counters, since these are used to check connectivity
between peers and are expected to have loss when the network is unstable.</p>
</div>
<div id="show_sync" class="ulist">
<ul>
<li>
<p>show sync</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the link state seqno and sub seqno sums.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>    user   |        start      | link_seqno | link_sum | sub_seqno | sub_sum | hb_diff | mc_req | mc_res | req_adj | res_adj | ping_adj
-----------+-------------------+------------+----------+-----------+---------+---------+--------+--------+---------+---------+---------
    chex.* | 0225 01:38:14.590 |          5 |     1447 |         0 |   81677 |         |        |        |         |         |
   edo_a.1 | 0224 17:07:32.126 |         25 |     1447 |         0 |   81653 |       0 |      0 |      0 |       0 |       0 |        0
  edo_a2.3 | 0224 17:07:29.173 |          8 |        0 |         2 |       0 |       0 |      0 |      0 |       0 |       0 |        0
  edo_a1.4 | 0224 17:07:27.696 |          8 |        0 |         2 |       0 |       0 |      0 |      0 |       0 |       0 |        0
  edo_a3.5 | 0224 17:07:30.591 |          8 |        0 |      6673 |       0 |       0 |      0 |      0 |       0 |       0 |        0
  edo_a4.6 | 0224 17:07:32.052 |          7 |        0 |      6874 |       0 |       0 |      0 |      0 |       0 |       0 |        0
  robo_a.7 | 0224 17:07:26.471 |         18 |        0 |         0 |       0 |       0 |      0 |      0 |       0 |       0 |        0
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> field is when the process started.  The <code>link_seqno</code> and <code>link_sum</code>
are the link state seqno and the sum of all of the peers link state seqnos.
The <code>sub_seqno</code> and <code>sub_sum</code> are the subscription seqno and the sum of all
peers subscription seqnos.  These sums will only appear then the nodes is
directly connected to the peer, since they are the values last seen in the
heartbeat messages.</p>
</div>
<div class="paragraph">
<p>The sequence numbers are always increasing after a change in the link state or
subscription state, so the sums of these seqnos are unique for the current
network state and provide a way for peers to check whether they are in sync
with the network.</p>
</div>
<div class="paragraph">
<p>These are exchanged with the heartbeat messages.  When a difference is detected,
the <code>hb_diff</code> is incremented and a <code>_M.sync</code> message is multicast to the network.
When a peer receives the sync message, it checks that their sums match with the
sending peer.  If they do not match, then they reply with their current link
state and subscription seqno values in a <code>_I.&lt;nonce&gt;.sync</code> point to point
message.  When a peer receives the sync reply it checks that these are in sync
and requests adjacency with <code>_I.&lt;nonce&gt;.sync_req</code> if they do not.</p>
</div>
<div class="paragraph">
<p>The <code>hb_diff</code> may not always result in an actual difference with the network,
since it is possible that a subscription or a link state message is received
and applied to the peer at a different rate than the heartbeat is received, but
the reply of the current sequence numbers at the peer will most likely be less
than or equal the state of the network when the peer is in sync.</p>
</div>
<div class="paragraph">
<p>The <code>mc_req</code> is the number of <code>_M.sync</code> message received, <code>mc_res</code> is the
number of <code>_I.&lt;nonce&gt;.sync</code> messages received.  The <code>req_adj</code> is the number of
adjacency requests made as a result of the <code>_M.sync</code> messages, and <code>res_adj</code> is
adjacency requests made as a result of the <code>_I.&lt;nonce&gt;.sync</code> messages and
<code>ping_adj</code> is adjacency requests made as a result of <code>_I.&lt;nonce&gt;.ping</code>
messages.</p>
</div>
<div id="show_pubtype" class="ulist">
<ul>
<li>
<p>show pubtype</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a message header is created or unpacked, a counter of the subject class is
incremented.  This shows these counters.  These are only messages that are
processed by the network, it is possible that two clients within the IPC
transport are exchanging messages, these are not counted.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[7]&gt; show pubtype
      type       | recv_count | send_count
-----------------+------------+-----------
 u_session_hello |          0 |          1
    u_session_hb |      68761 |      68765
      u_peer_add |        134 |         35
      u_peer_del |         16 |          4
  u_bloom_filter |         39 |          3
     u_adjacency |        115 |          4
      u_sub_join |     224621 |         24
     u_sub_leave |     223689 |          0
    u_psub_start |        110 |         89
    u_inbox_auth |          4 |          8
    u_inbox_subs |         10 |          0
    u_inbox_ping |      12476 |      12529
    u_inbox_pong |      12529 |      12481
     u_inbox_rem |          1 |          0
   u_inbox_resub |          0 |        202
 u_inbox_add_rte |          4 |          4
u_inbox_sync_req |          2 |         30
u_inbox_sync_rpy |         29 |          0
 u_inbox_adj_req |          3 |         10
 u_inbox_adj_rpy |         21 |          6
     u_inbox_ack |          0 |          1
     u_inbox_any |          0 |     224476
         u_inbox |          0 |          1
    u_mcast_ping |          5 |          0
 u_inbox_any_rte |         80 |          0
   mcast_subject | 1528812397 |          0</code></pre>
</div>
</div>
<div id="show_inbox" class="ulist">
<ul>
<li>
<p>show inbox [U]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the types of the last 32 system RPC messages sent and received for each
peer.  Some peers may not have any of these if they are not directly connected.</p>
</div>
<div class="paragraph">
<p>This is an example of a peer attached to the console connecting to a larger
network:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>chex.rvd[xpO5ODZvoOcUMJ60QVaSBg]@chex[139]&gt; inbox
  user  | send seqno |     send type    | recv seqno |     recv type
--------+------------+------------------+------------+-----------------
lex_a.1 |          1 |     u_inbox_auth |          1 | u_inbox_sync_rpy
        |          2 |  u_inbox_add_rte |          2 |     u_inbox_auth
        |          3 |  u_inbox_adj_req |          3 |  u_inbox_add_rte
        |          4 | u_inbox_sync_req |          4 |  u_inbox_adj_rpy
        |          5 | u_inbox_sync_req |          5 | u_inbox_sync_rpy
        |          6 | u_inbox_sync_req |          6 | u_inbox_sync_rpy
        |          7 | u_inbox_sync_req |          7 | u_inbox_sync_rpy
        |          8 | u_inbox_sync_req |          8 | u_inbox_sync_rpy
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first 3 sequences are the result of authentication, which causes both peers
to exchange all their known peers.  The following <code>u_inbox_sync_req</code> and
<code>u_inbox_sync_rpy</code> pairs are used to request the peers which are not yet
authenticated.  In this case, the connecting peer has no peers and the peer
attached to the network has lots of peers that need synchronizing.</p>
</div>
<div id="show_loss" class="ulist">
<ul>
<li>
<p>show loss</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the counters of repeated messages (old message sequences), messages not
subscribed, have message loss, or have inbox loss.</p>
</div>
<div class="paragraph">
<p>When a message is repeated or not subscribed, a counter is incremented and the
message is tossed.  These types of events can occur through normal operation
and don&#8217;t have an impact on clients.</p>
</div>
<div class="paragraph">
<p>The repeated messages can occur during network instability and not subscribed
messages can occur because an unsubscribe has not yet reached the publisher or
because the bloom filter did not filter the subject.</p>
</div>
<div class="paragraph">
<p>The message loss counters are more critical to correct behavior, since this
indicates that messages did not reach all subscriptions.  The inbox message
loss can occur normally since these are used to synchronize peers during
network instability, they are used to stabilize the network.</p>
</div>
<div class="paragraph">
<p>The point to point messages using the <code>_INBOX</code> prefix will also use the inbox
sequences, but even these are not as critical since clients will have timeouts
and retry the operation that uses an <code>_INBOX</code></p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[11]&gt; show loss
   user    | repeat | rep time | not sub | not time | msg loss |      loss time    | ibx loss |      ibx time
-----------+--------+----------+---------+----------+----------+-------------------+----------+------------------
  lex_a2.1 |      0 |          |       0 |          |        0 |                   |        0 |
  lex_a3.2 |      0 |          |       0 |          |        0 |                   |        0 |
  lex_a4.3 |      0 |          |       0 |          |        0 |                   |        0 |
   edo_a.5 |      0 |          |       0 |          |        0 |                   |        0 |
  robo_a.6 |      0 |          |       0 |          |        0 |                   |        0 |
  edo_a4.7 |      0 |          |       0 |          |        0 |                   |        1 | 0209 08:22:25.120
  edo_a3.8 |      0 |          |       0 |          |        0 |                   |        1 | 0209 08:22:25.120
  edo_a1.9 |      0 |          |       0 |          |      640 | 0209 08:24:31.960 |        0 |
 edo_a2.10 |      0 |          |       0 |          |      655 | 0209 08:24:32.080 |        0 |
robo_a3.11 |      0 |          |       0 |          |        0 |                   |        1 | 0209 08:22:25.120
robo_a2.12 |      0 |          |       0 |          |      630 | 0209 08:24:31.761 |        0 |
robo_a4.13 |      0 |          |       0 |          |        0 |                   |        1 | 0209 08:22:25.120
robo_a1.14 |      0 |          |       0 |          |      647 | 0209 08:24:23.841 |        0 |
 lee_a1.15 |      0 |          |       0 |          |        1 | 0209 08:22:27.841 |        0 |
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>user</code> is the sender of the message.  The <code>repeat</code>, <code>rep time</code> is the count
and time stamp of the last instance.  The <code>not sub</code>, <code>not time</code> are for the
not subscribed messages.  The <code>msg loss</code>, <code>loss time</code> are for the multicast
message loss.  The <code>ibx loss</code>, <code>ibx time</code> are for the point to point inbox
message loss.</p>
</div>
<div id="show_skew" class="ulist">
<ul>
<li>
<p>show skew</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the system time skew between peers.  There are several messages that
include a time stamp which can be used to estimate the system clock skew between
peers.  This is useful to guard against message replays.  If a peer message
arrives and the time + skew is older than the subscription window, then it is
treated as a repeated message.  When the time is within the subscription window,
then a sequence will be associated with the last message received from peer.
The subscription window rotate time is configurable, described in
<a href="#parameters">Parameters</a> of the config section.  This details of the loss calculation is
described in <a href="#msg_loss">[msg_loss]</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[11]&gt; show skew
   user    |   lat |    hb   | ref |   ping   |   pong  |        time
-----------+-------+---------+-----+----------+---------+------------------
  lex_a2.1 | 241us |  63.5us |   0 |   33.7us | -32.5us | 0209 08:47:48.395
  lex_a3.2 | 119us |  76.9us |   0 |   31.4us | -7.15us | 0209 08:47:48.395
  lex_a4.3 | 157us |   236us |   0 |   32.7us | -15.1us | 0209 08:47:48.395
   edo_a.5 | 302us |  -483us |   4 | -0.161us | -26.1us | 0209 08:47:48.395
  robo_a.6 | 291us | -1.09ms |   4 |  0.154us | -1.41ms | 0209 08:47:48.397
  edo_a4.7 | 521us |   282us |   4 |   31.6us |  -131us | 0209 08:47:48.395
  edo_a3.8 | 512us |   250us |   4 |   -5.1us | -14.7us | 0209 08:47:48.395
  edo_a1.9 | 308us |  1.26ms |   4 |  -12.8us |  72.8us | 0209 08:47:48.395
 edo_a2.10 | 452us |  1.02ms |   4 |  -13.2us |  -222us | 0209 08:47:48.395
robo_a3.11 | 528us |   314us |   4 |     28us | -1.44ms | 0209 08:47:48.397
robo_a2.12 | 468us |   477us |   4 |  -3.79us | -1.47ms | 0209 08:47:48.397
robo_a4.13 | 633us |   571us |   4 |   -8.7us |  -1.5ms | 0209 08:47:48.397
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first message a peer will see when connecting is the heartbeat message and
authentication messages.  These have a time attached to them and this is the
first time skew calculation that a peer will have.  The <code>hb</code> contains this
value and the <code>ref</code> is the uid of the peer that is attached and calculated
the skew.  The <code>ping</code> and <code>pong</code> values are calculated later when a ping
pong sequence of messages are exchange.  These are more accurate because there
is a larger sample size as the uptime increases.  The <code>time</code> is the last time
a skew was calculated.</p>
</div>
<div id="show_reachable" class="ulist">
<ul>
<li>
<p>show reachable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show which transport links can be used to reach a peer.  This table associates
a connection <code>fd</code> with a list of peers that are using it.  If this connection
is lost, then these are peers that may be affected by this event.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[12]&gt; show reachable
   user    |   path  | fd |     tport
-----------+---------+----+------------
  lex_a2.1 | 0,1,2,3 | 19 | lex_amesh.2
  lex_a3.2 |         |    |
  lex_a4.3 |         |    |
  dex_a.24 |         |    |
  pic_a.29 |         |    |
  lee_a.18 |         |    |
  robo_a.6 |         |    |
   edo_a.5 |         |    |
-----------+---------+----+------------
  lex_a3.2 | 0,1,2,3 | 21 | lex_amesh.3
  lex_a2.1 |         |    |
  lex_a4.3 |         |    |
  dex_a.24 |         |    |
  pic_a.29 |         |    |
  robo_a.6 |         |    |
   edo_a.5 |         |    |
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>user</code> is the peer, the <code>path</code> is a list of paths used with the connection
<code>fd</code>, and the <code>tport</code> is the transport that contains the connection.</p>
</div>
<div id="show_tree" class="ulist">
<ul>
<li>
<p>show tree [U]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the multicast tree for a user or self.  This iterates through the
adjacency tables by cost and shows the which peers will be reached after
each step.  The cost increases until all the peers are exhausted.  If
a <code>U</code> argument is present, then the multicast tree starts from that peer
instead of the peer attached to the console.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[14]&gt; show tree
cost | set | alt |  source  |     tport    |   dest
-----+-----+-----+----------+--------------+--------
1000 |   0 |   0 | lex_a1.* |  lex_amesh.2 |  lex_a2
1000 |   1 |   0 | lex_a1.* |  lex_amesh.3 |  lex_a3
1000 |   2 |   0 | lex_a1.* |  lex_amesh.4 |  lex_a4
1000 |   3 |   0 | lex_a1.* |  lex_amesh.5 |   lex_a
-----+-----+-----+----------+--------------+--------
2000 |   0 |   0 | lex_a.33 |    fo_mesh.7 |   edo_a
2000 |   2 |   0 | lex_a.33 |    fo_mesh.9 |  robo_a
2000 |   1 |   0 | lex_a.33 |    fo_mesh.8 |   lee_a
2000 |   4 |   0 | lex_a.33 |   fo_mesh.11 |   dex_a
2000 |   3 |   0 | lex_a.33 |   fo_mesh.10 |   pic_a
-----+-----+-----+----------+--------------+--------
3000 |   0 |   0 |  edo_a.5 |  edo_amesh.4 |  edo_a4
3000 |   1 |   0 |  edo_a.5 |  edo_amesh.5 |  edo_a3
3000 |   2 |   0 |  edo_a.5 |  edo_amesh.6 |  edo_a1
3000 |   3 |   0 |  edo_a.5 |  edo_amesh.7 |  edo_a2
3000 |   4 |   0 | robo_a.6 | robo_amesh.4 | robo_a3
3000 |   5 |   0 | robo_a.6 | robo_amesh.5 | robo_a2
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>set</code> is an index into the table used for the next hop, this is calculated
by transitioning across the transport links.  Since the uids are displayed in
order, the <code>set</code> may jump back and forth through the table.  The <code>alt</code> counter
is an alternate path counter.  Only the 0 <code>alt</code> path is used, but the others
are displayed.</p>
</div>
<div class="paragraph">
<p>The <code>source</code> is the forwarding peer that sends the message, the <code>tport</code> is the
transport local to the <code>source</code>, and <code>dest</code> is the receiver.</p>
</div>
<div id="show_path" class="ulist">
<ul>
<li>
<p>show path [P]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the transports used to reach a peer for a path.  This is the forwarding
table that is used to send a message from the local peer to other peers.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[15]&gt; show path
    tport   | cost | path_cost |    dest
------------+------+-----------+----------
lex_amesh.2 | 1000 |      1000 |  lex_a2.1
lex_amesh.3 | 1000 |      1000 |  lex_a3.2
lex_amesh.4 | 1000 |      1000 |  lex_a4.3
lex_amesh.5 | 1000 |      2000 |   edo_a.5
lex_amesh.5 | 1000 |      3000 |  edo_a4.7
lex_amesh.5 | 1000 |      3000 |  edo_a3.8
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>tport</code> is used for sending a message to <code>dest</code>.  The <code>cost</code> is the
first hop cost, the <code>path_cost</code> is the total cost through all hops.</p>
</div>
<div id="show_forward" class="ulist">
<ul>
<li>
<p>show forward [P]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the forwarding table for a message received from each of the peers.
When a message is received from a peer, it may need to be forwarded to
other peers to completely cover the network.  This shows the forwarding tables
for each peer.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[16]&gt; show forward
  source  |     tport   | cost
----------+-------------+-----
 lex_a1.* | lex_amesh.2 | 1000
          | lex_amesh.3 | 1000
          | lex_amesh.4 | 1000
          | lex_amesh.5 | 1000
----------+-------------+-----
 lex_a2.1 |             |
----------+-------------+-----
 lex_a3.2 |             |
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>source</code> is index the forwarding table used, the <code>tport</code> is the transport
used to forward the message.</p>
</div>
<div id="show_fds" class="ulist">
<ul>
<li>
<p>show fds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show what each fd is used for.  This iterates the <code>fd</code> tables and shows what
each <code>fd</code> is doing.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[17]&gt; show fds
fd | rid |      bs     |      br      |     ms    |     mr     | ac | rq | wq | fl |         type        |      kind     |           name           |           address
---+-----+-------------+--------------+-----------+------------+----+----+----+----+---------------------+---------------+--------------------------+--------------------------
 3 |  -1 |           0 |        15321 |         0 |          0 |    |  0 |  0 |    |              logger |        stdout |                          |
 5 |  -1 |             |              |           |            |    |    |    |    |         timer_queue |         timer |                          |
 7 |  -1 |           0 | 717092458452 |         0 | 1943883309 |    |    |    |    |           ipc_route |           ipc |                  rvd.ipc |
 8 |  -1 |           0 |         4235 |         0 |          0 |    |  0 |  0 |    |              logger |        stderr |                          |
 9 |  -1 |             |              |           |            |    |    |    |    |       console_route |       console |              rvd.console |
10 |  -1 |           0 |     99146804 |         0 |     690776 |    |    |    |    |         session_mgr |       session |              rvd.session |
11 |   0 |           0 |  64848767199 |         0 |  261901166 |    |    |    |    |     transport_route |         tport |          rvd.ipc.tport.0 |
12 |   0 |             |              |           |            | 12 |    |    |    |           rv_listen |     rv_listen |        rvd.ipc.rv.list.0 |            127.0.0.1:7500
13 |  -1 |             |              |           |            |  1 |    |    |    |       telnet_listen | telnet_listen |               telnet.tel |              0.0.0.0:2222
14 |  -1 |         210 |            0 |         1 |          0 |    |    |    |    |        name_connect |    mcast_send |           name.eth0.send |        239.23.22.217:8327
15 |  -1 |        1000 |         1260 |         5 |          6 |    |    |    |    |         name_listen |    mcast_recv |           name.eth0.recv |        239.23.22.217:8327
16 |  -1 |             |              |           |            |    |    |    |    |         name_listen |    ucast_recv |          name.eth0.inbox |          172.18.0.2:33643
17 |   1 |             |              |           |            |    |    |    |    |     transport_route |         tport |    rvd.lex_amesh.tport.1 |
18 |   1 |             |              |           |            |  5 |    |    |    | ev_tcp_tport_listen |    tcp_listen | rvd.lex_amesh.tcp_list.1 |          172.18.0.2:42341
19 |   2 |  9458891878 |     28871168 |  27427393 |     121986 |    |  0 |  0 |    |        ev_tcp_tport |    tcp_accept |  rvd.lex_amesh.tcp_acc.1 | lex_a2.1@172.18.0.3:41708
20 |   2 |           0 |     16338022 |         0 |      50587 |    |    |    |    |     transport_route |         tport |    rvd.lex_amesh.tport.2 |
21 |   3 |  9548489486 |     28505122 |  27617221 |     120205 |    |  0 |  0 |    |        ev_tcp_tport |    tcp_accept |  rvd.lex_amesh.tcp_acc.1 | lex_a3.2@172.18.0.4:44630
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fields are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File descriptor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport id that fd belongs to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">br</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messages sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listener accept count</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes in the receive queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes in the send queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket flags, R,r,&lt;: reading, W,w,&gt;: writing, +: processing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What type of fd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kind</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What class of fd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with fd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local address</p></td>
</tr>
</tbody>
</table>
<div id="show_buffers" class="ulist">
<ul>
<li>
<p>show buffers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the buffer usage of each connection.  These buffers expand to contain
an entire message, since there is no streaming of large messages.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[18]&gt; show buffers
fd |   wr  |  wmax |   rd  |  rmax | zref |    send   |    recv   | mall | pall |           name
---+-------+-------+-------+-------+------+-----------+-----------+------+------+------------------------
 3 | 32768 | 32768 | 16384 | 16384 |    0 |         0 |       124 |    0 |    0 |
 8 | 32768 | 32768 | 16384 | 16384 |    0 |         0 |        74 |    0 |    0 |
19 | 32768 | 32768 | 16384 | 16384 |    0 |  27189290 |     67973 |    0 |    0 | rvd.lex_amesh.tcp_acc.1
21 | 32768 | 32768 | 16384 | 16384 |    0 |  27224765 |     66485 |    0 |    0 | rvd.lex_amesh.tcp_acc.1
23 | 32768 | 32768 | 16384 | 16384 |    0 |  30118303 |     68727 |    0 |    0 | rvd.lex_amesh.tcp_acc.1
25 | 32768 | 32768 | 16384 | 16384 |    0 |   5498186 |  38629165 |    0 |    0 | rvd.lex_amesh.tcp_acc.1
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fields are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File descriptor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write buffer size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wmax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The largest write buffer used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read buffer size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rmax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The largest read buffer used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter incremented after of zero copy sends</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter incremented when malloc() is used to make a buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter incremented when a buffer is borrowed from the buffer pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name associated with fd</p></td>
</tr>
</tbody>
</table>
<div id="show_windows" class="ulist">
<ul>
<li>
<p>show windows</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the size and counts of the subject publish and subscribe windows as
well as the size of subscription tables and bloom filters.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[19]&gt; show windows
   tab  | count |   size  | win_size | max_size |     rotate_time   | interval
--------+-------+---------+----------+----------+-------------------+---------
    sub | 22515 | 5534080 |  8388608 |  5534080 | 0208 13:23:11.393 |       10
sub_old |     0 |       0 |          |          | 0208 13:23:01.393 |
    pub |  3737 |  344112 |  4194304 |   344112 | 0208 13:23:11.393 |       10
pub_old |     0 |       0 |          |          | 0208 13:23:01.393 |
  inbox |  2724 |  817824 |          |          | 0209 09:52:42.761 |
  route |   137 |   58848 |          |          |                   |
  bloom |  1135 |   18392 |          |          |                   |
     rv |   102 | 1290420 |          |          |                   |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first two are the subscription and publish windows.  These tables are
rotated to old when they get to <code>win_size</code> with at least <code>interval</code> seconds.
The <code>max_size</code> is the largest size of this window.</p>
</div>
<div class="paragraph">
<p>The <code>inbox</code> entry is a route cache for subjects that have a <code>_INBOX</code> prefix.
The <code>route</code> entry is a cache for routes, indexed by subject hash.  The <code>bloom</code>
entry is the sum of the size of bloom filters for every peer in the network.
The <code>rv</code> entry is the subscription table for RV clients attached.</p>
</div>
<div id="show_blooms" class="ulist">
<ul>
<li>
<p>show blooms [P]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show where the bloom filters are used for a path.  The forwarding table has
only one transport entry for each peer, path combination.  If a message is
forwarded on more than one transport, it is because there are multiple peers
that are subscribed across multiple transports for the path.  The receiving side
also filters the messages through the bloom filters by calculating the ports
that are needed for the path to completely cover the network.  There may be
redundant transports that are inactive for each path either because the cost
is more or the path selection prefers one transport over the other.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[20]&gt; show blooms
fd |   dest   |     tport   |                                     bloom                                   |       prefix       | detail | subs | total
---+----------+-------------+-----------------------------------------------------------------------------+--------------------+--------+------+------
 9 |  console |       ipc.0 |                                                                   (console) |                  0 |      0 |    0 |     0
11 |    route |       ipc.0 |                                                                 (all-peers) |                  0 |      0 |    0 |     0
---+----------+-------------+-----------------------------------------------------------------------------+--------------------+--------+------+------
 7 |      ipc | lex_amesh.1 |                                                                       (ipc) | 0x000061DF00C38000 |      0 |   24 |   113
10 |  session | lex_amesh.1 |                                                            (console), (sys) |         0x04000108 |      0 |    7 |    15
17 |    route | lex_amesh.1 |                                                                 (all-peers) |                  0 |      0 |    0 |     0
---+----------+-------------+-----------------------------------------------------------------------------+--------------------+--------+------+------
 7 |      ipc | lex_amesh.2 |                                                                       (ipc) | 0x000061DF00C38000 |      0 |   24 |   113
10 |  session | lex_amesh.2 |                                                            (console), (sys) |         0x04000108 |      0 |    7 |    15
19 | lex_a2.1 | lex_amesh.2 |                                                              (peer), lex_a2 | 0x0000008004000108 |      0 |   84 |    91
20 |    route | lex_amesh.2 |                                                                 (all-peers) |                  0 |      0 |    0 |     0
---+----------+-------------+-----------------------------------------------------------------------------+--------------------+--------+------+------
 7 |      ipc | lex_amesh.3 |                                                                       (ipc) | 0x000061DF00C38000 |      0 |   24 |   113
10 |  session | lex_amesh.3 |                                                            (console), (sys) |         0x04000108 |      0 |    7 |    15
21 | lex_a3.2 | lex_amesh.3 |                                                              (peer), lex_a3 | 0x0000008004000108 |      0 |   98 |   105
22 |    route | lex_amesh.3 |                                                                 (all-peers) |                  0 |      0 |    0 |     0
---+----------+-------------+-----------------------------------------------------------------------------+--------------------+--------+------+------
 7 |      ipc | lex_amesh.4 |                                                                       (ipc) | 0x000061DF00C38000 |      0 |   24 |   113
10 |  session | lex_amesh.4 |                                                            (console), (sys) |         0x04000108 |      0 |    7 |    15
23 | lex_a4.3 | lex_amesh.4 |                                                              (peer), lex_a4 | 0x0000008004000108 |      0 |   89 |    96
24 |    route | lex_amesh.4 |                                                                 (all-peers) |                  0 |      0 |    0 |     0
---+----------+-------------+-----------------------------------------------------------------------------+--------------------+--------+------+------
 7 |      ipc | lex_amesh.5 |                                                                       (ipc) | 0x000061DF00C38000 |      0 |   24 |   113
10 |  session | lex_amesh.5 |                                                            (console), (sys) |         0x04000108 |      0 |    7 |    15
25 | lex_a.33 | lex_amesh.5 | (peer), lex_a, pic_a, edo_a, lee_a4, lee_a3, lee_a1, lee_a2, edo_a4, edo_a2 | 0x000061DF04C38108 |      0 |  482 |   636
   |          |             |      edo_a1, edo_a3, dex_a1, dex_a2, dex_a3, dex_a4, pic_a4, pic_a1, pic_a2 |                    |        |      |
   |          |             |                                                        pic_a3, lee_a, dex_a |                    |        |      |
26 |    route | lex_amesh.5 |                                                                 (all-peers) |                  0 |      0 |    0 |     0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every peer has a bloom filter associated with it.  The <code>console</code>, <code>ipc</code>, and
<code>sys</code> filters are the local bloom filters which are combined into one filter in
another peer.  They are split in the local peer so that the traffic destination
can be split to the separate processing functions.  The <code>sys</code> filter only match
the subjects that are used for the system, namely, the <code>_I.&lt;nonce&gt;.&gt;</code> subject
and the <code>_M.&gt;</code> subject.  The <code>console</code> are the subjects subscribed by the
console.  The <code>ipc</code> are the subjects subscribed by clients.  The <code>all-peers</code>
are the combination of all the peers subscriptions, this is used for receiving
messages.  The individual peer bloom filters are for forwarding messages.</p>
</div>
<div class="paragraph">
<p>The fields are:</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File descriptor for the connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the message would go</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The transport that is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bloom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bloom filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A bit mask of the prefix match length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">detail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A bit mask of the prefix when a suffix is matched or sharded</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The subscription count, not including the patterns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">total</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The subscription count including the patterns</p></td>
</tr>
</tbody>
</table>
<div id="show_match" class="ulist">
<ul>
<li>
<p>show match S</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show which peer bloom filters match a subject.  If a message was published
with subject <code>S</code>, this shows which peer&#8217;s bloom filter would match it.  This
doesn&#8217;t match against the local filters.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[33]&gt; show match _7500.RSF.REC.AVP.N
   user
---------
lee_a2.16</code></pre>
</div>
</div>
<div id="show_graph" class="ulist">
<ul>
<li>
<p>show graph</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the graph description of the network.  This creates a description of the
network by matching the names of the transports with the names that the peers
use.  This doesn&#8217;t use any network probing, it uses the link state database to
calculate the network connectivity.  The link state database doesn&#8217;t have
connection IP addresses associated with it, but it does have a link name and
link type.  The name/types are enough to describe the network, but doesn&#8217;t
show how the links are connected to the host with IP addresses.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[34]&gt; show graph
start lex_a1
node edo_a1 edo_a2 edo_a3 lex_a1 lex_a2 edo_a4 edo_a lex_a3 lex_a4 lee_a1 lee_a2 lee_a3 dex_a1 lee_a4 lee_a dex_a2 dex_a3 dex_a4 dex_a pic_a1 pic_a2 pic_a3 pic_a4 pic_a lex_a
mesh_lex_amesh lex_a1 lex_a2 lex_a3 lex_a4 lex_a
mesh_edo_amesh edo_a edo_a4 edo_a3 edo_a1 edo_a2
mesh_fo_mesh edo_a lee_a dex_a pic_a lex_a
mesh_lee_amesh lee_a1 lee_a2 lee_a4 lee_a lee_a3
mesh_dex_amesh dex_a1 dex_a2 dex_a3 dex_a4 dex_a
mesh_pic_amesh pic_a3 pic_a4 pic_a1 pic_a2 pic_a</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>start</code> is the peer attached to the console.  The <code>node</code> is the list of
peers in the network ordered by age.  The following lines have a prefix which
is the type of transport used, which is either <code>mesh</code>, <code>tcp</code>, or <code>pgm</code>.  The
suffix of the type is the name of the transport.  Following the "type_name" are
the peers which are connected using this transport.  If the cost is not the
default of 1000, then there will be a <em>:</em> followed by the cost of the
transport.</p>
</div>
<div id="show_cache" class="ulist">
<ul>
<li>
<p>show cache</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the route cache hit and miss statistics.  To reduce the number of bloom
filters and hash tables that a message must flow through to match the subject,
the route for the subject is cached.  This cache needs to be updated when a
subscription operation occurs, so this purges the entries which are affected by
these operations, reducing the cache effectiveness.  When a new subject
published will also cause a miss.  The cache size has a maximum of 256K
entries, and when this is hit, the cache is purged and recreated.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[35]&gt; show cache
         tport        | hit_pct |      hit    |    miss    | max_cnt | max_size
----------------------+---------+-------------+------------+---------+---------
      rvd.ipc.tport.0 |   86.70 | 14600408979 | 2239005394 |   24576 |      130
rvd.lex_amesh.tport.1 |    0.00 |           0 |          0 |       0 |        0
rvd.lex_amesh.tport.2 |   84.16 |  1513720684 |  284704081 |    1536 |      447
rvd.lex_amesh.tport.3 |   84.17 |  1513725449 |  284673772 |    1536 |      453
rvd.lex_amesh.tport.4 |   84.16 |  1513723831 |  284727847 |    1536 |      444
rvd.lex_amesh.tport.5 |   88.06 | 16786195897 | 2275244513 |   24576 |      209</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each <code>tport</code> has a route cache.  The <code>hit_pct</code> is a percentage, hit * 100 /
total.  The <code>hit</code> is how many times an entry was present in the cache, a <code>miss</code>
is not present.  The <code>max_cnt</code> is the maximum number of cache entries that have
occurred since the transport was created.  The <code>max_size</code> is the max data size
of the entries, which are fds.  Some of the entries will have zero size, when
there is no route for the subject.</p>
</div>
<div id="show_poll" class="ulist">
<ul>
<li>
<p>show poll</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the latency of poll states, the average time used for processing timers,
read, write, and routing events.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>lex_a1.rvd[L0MOCmhQpwX2JqsBjYBypA]@lex_a1[36]&gt; show poll
timer_lat | timer_cnt | read_lat |  read_cnt  |    rd_lo   | route_lat |  route_cnt | write_lat |  write_cnt | wr_poll | wr_hi
----------+-----------+----------+------------+------------+-----------+------------+-----------+------------+---------+------
   2.52us |   5548967 |   4.77us | 4936398767 | 2053110538 |    11.4us | 1434068849 |    15.1us | 2053110184 |       0 |    66</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a busy router, the read, route, write operations will process multiple
messages at a time, depending on how many fit inside of a read buffer.  A read
buffer is 16KB and is resized only when a large message requires more memory.
The sum of these is close to the average latency used by the router per
message, even if the time used per message is a fraction of that, since the
messages are processed in batches.</p>
</div>
<div class="paragraph">
<p>The <code>read_cnt</code> is the sum of the counts in the <code>rd_lo</code> and <code>read</code> states, the
<code>write_cnt</code> is the sum of the counts in the <code>write</code>, <code>wr_hi</code>, <code>wr_poll</code> states.
The difference between <code>rd_lo</code> and <code>read</code> is that the <code>rd_lo</code> state occurs after
the read buffer is full or the fd has no more data to read.  The <code>wr_hi</code> are
the number of times that the write buffer is full.  The <code>wr_poll</code> state is the
number of times that the fd is part of the poll set because there is back
pressure on the connection.</p>
</div>
<div id="show_hosts" class="ulist">
<ul>
<li>
<p>show hosts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Show the RV host services.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>chex.rvd[UjD6fIiAd1lXaCPmnarXUg]@chex[129]&gt; show hosts
 svc |  session |   session ip  | port |        start      | cl |     bs     |      br     |    ms    |     mr    | idl | odl
-----+----------+---------------+------+-------------------+----+------------+-------------+----------+-----------+-----+----
7500 | 5230FA7C | 82.48.250.124 | 7500 | 0226 22:38:27.401 |  2 | 6448254563 | 28658399876 | 26756243 | 113590979 |   0 |   0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>svc</code> is the service number, <code>session</code> is the session identifier, <code>session ip</code> is the IPv4 address, <code>port</code> is the daemon
port number, <code>start</code> is when the host started.  The <code>cl</code> is the active number of clients.  If the number of clients is zero
then the host service is not active, it doesn&#8217;t publish any <code>_RV</code> system subjects.  The <code>bs</code>, <code>br</code>, <code>ms</code>, <code>mr</code>, <code>idl</code>, <code>odl</code> are
the same stats published with the <code>_RV.INFO.SYSTEM.HOST.STATUS.5230FA7C</code> message.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">svc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">session ip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session identifier in IPv4 address format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daemon port number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start time of the host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of clients connected to service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">br</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messages sent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messagtes received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">idl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inbound data loss, messages lost by subscriptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">odl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outbound data loss, messsages lost by publishers</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>session ip</code> will be a random address unless configured with the <code>no_fakeip</code> setting, described in <a href="#Tib_RV">Tib RV</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_pub_sub">Test Pub Sub</h3>
<div class="paragraph">
<p>These commands do pub/sub through the console.  The messages have a format
attached to them, which is an integer value mapped to decoding methods.  If
the format is matched with a decoder, then it is decoded to field/value
pairs and printed.  If a method is not matched, then the value is an opaque
string of bytes and that displayed.</p>
</div>
<div id="test_sub" class="ulist">
<ul>
<li>
<p>sub S [F]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Subscribe to subject <code>S</code>.  If a file is present, then the publishes are sent to
the file instead of printed to the console.</p>
</div>
<div id="test_unsub" class="ulist">
<ul>
<li>
<p>unsub S [F]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unsubscribe to subject <code>S</code>.  If a file is present, then stop the publishes sent
to the file.</p>
</div>
<div id="test_psub" class="ulist">
<ul>
<li>
<p>psub W [F]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Subscribe to RV style wildcard <code>W</code>.  If a file is present, then the publishes
are sent to the file instead of printed to the console.</p>
</div>
<div id="test_punsub" class="ulist">
<ul>
<li>
<p>punsub W [F]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unsubscribe to RV style wildcard <code>W</code>.  If a file is present, then stop the
publishes sent to the file.</p>
</div>
<div id="test_gsub" class="ulist">
<ul>
<li>
<p>gsub W [F]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Subscribe to glob style wildcard <code>W</code>.  If a file is present, then the publishes
are sent to the file instead of printed to the console.</p>
</div>
<div id="test_gunsub" class="ulist">
<ul>
<li>
<p>gunsub W [F]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unsubscribe to glob style wildcard <code>W</code>.  If a file is present, then stop the
publishes sent to the file.</p>
</div>
<div id="test_pub" class="ulist">
<ul>
<li>
<p>pub S M</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Send a message <code>M</code> so subscriptions <code>S</code>.</p>
</div>
<div id="test_trace" class="ulist">
<ul>
<li>
<p>trace S M</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Send a message <code>M</code> to subscriptions <code>S</code> with the trace flag set, which causes
any of the intermediate hops as well as the final destination to send an ack
reply.</p>
</div>
<div id="test_ack" class="ulist">
<ul>
<li>
<p>ack S M</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Send a message <code>M</code> to subscription <code>S</code> with the ack flag set, which causes
the destinations to send an ack reply.</p>
</div>
<div id="test_rpc" class="ulist">
<ul>
<li>
<p>rpc S M</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Send a message <code>M</code> to subscription <code>S</code> with a return inbox.</p>
</div>
<div id="test_any" class="ulist">
<ul>
<li>
<p>any S M</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Randomly choose a subscription match for <code>S</code> and forward message <code>M</code> to that
endpoint.  This would include both wildcard subscriptions and normal ones.</p>
</div>
<div id="test_cancel" class="ulist">
<ul>
<li>
<p>cancel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>cancel</code> command stops any console subscription or RPC, such as <code>ping</code>.  This
marks the endpoint as canceled, so if results are returned after a <code>cancel</code>,
they will be discarded.</p>
</div>
<div id="test_reseed" class="ulist">
<ul>
<li>
<p>reseed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This alters the local bloom filter to use a different seed.  Changing the bloom
filter seed will alter the bits in the hash such that collisions occur at
different positions.  If a low rate subscription has a collision with a high
rate subscription, this would cause unnecessary traffic that can be avoided by
altering the bloom filter seed.  This doesn&#8217;t solve when the 32 bit hashes have
collisions, but these are much less likely than a bloom filter collision.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mute_the_logging">Mute the Logging</h3>
<div id="log_mute" class="ulist">
<ul>
<li>
<p>mute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log messages are normally printed to the console, this mutes them.  The log
is still present, using the <a href="#show_log:">log</a> command will show them and the
log file if active, will still be appended.  If messages to the console are
being printed too fast for the terminal to display them, this will
automatically turn on.</p>
</div>
<div id="log_unmute" class="ulist">
<ul>
<li>
<p>unmute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This removes the <code>mute</code> for printing log messages to the console.</p>
</div>
</div>
<div class="sect2">
<h3 id="_turn_onoff_debug_logging">Turn On/Off Debug Logging</h3>
<div id="debug_log" class="ulist">
<ul>
<li>
<p>debug I</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The integer value is either a mask or a list of strings that turn the debug
logging on or off.  When <code>debug 0</code> is used, this turns of the debug messages.</p>
</div>
<table class="tableblock frame-all grid-cols stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print the subjects as they are sent or received on a TCP connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pgm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print the subjects as they are sent or received on a PGM connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ibx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The inbox UDP protocol debugging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the message route forwarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User updates debugging, when changes are made to a user state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">link_state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link state message updates are printed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">peer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peer synchronization messages are printed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication messages are printed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System message dispatching, IPC message forwarding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heartbeat and ping messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription starts and stops</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg_recv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print system messages when they are received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg_hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dump the system messages in hex when they are received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">telnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the telnet protocol states</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x4000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display name transport update messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repeat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print when the repeated subjects are received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not_sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print when not subscribed subjects are received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print debugging when message loss occurs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adj</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print debugging when the link state Dijkstra algo runs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show debugging about connections, when establish or dropped or timers expire</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x100000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print when forwarding a stats, when have subs to _N.&gt; subjects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dist</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This causes the Dijkstra algo to run once</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kvpub</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on debugging when any message is processed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kvps</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on debugging when kv pubsub messages are processed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rv</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on debugging when rv message is processed</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The last 4 don&#8217;t have an integer mask because they use different debug
variables that the others.</p>
</div>
</div>
<div class="sect2">
<h3 id="_write_events_to_file">Write Events to File</h3>
<div id="write_events" class="ulist">
<ul>
<li>
<p>wevents F</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dumps the current events to a log file for examining later.  Useful when a
networking problem occurs and is hard to reproduce.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stop_the_server">Stop the Server</h3>
<div id="stop_die" class="ulist">
<ul>
<li>
<p>die [I]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exit the process without shutting down existing connections and sending bye
messages to the network.</p>
</div>
<div id="stop_quit" class="ulist">
<ul>
<li>
<p>quit/exit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Normal shutdown.  Existing connections will stop reading new messages send bye
messages to connected peers and flush the data in the write queues.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring">Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Monitoring.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-02-08 22:40:57 -0800
</div>
</div>
</body>
</html>